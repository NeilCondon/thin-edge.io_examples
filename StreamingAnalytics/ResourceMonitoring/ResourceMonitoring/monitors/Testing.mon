monitor Testing {
	
	event Trigger {}
	action onload() {
		spawn testCode();
	}
	
	float counter := 65.0;
	
	action testCode() {
		monitor.subscribe("out");
		on all RawCpuMeasurement() as cpu {
			log "cpu for you " + cpu.toString();
		}

		on all RawMemMeasurement() as mem {
			log "mem for you " + mem.toString();
		}

		on all Trigger() {
			float timestamp := currentTime;
			send RawCpuMeasurement(timestamp.toString() + ":" + counter.toString()) to "mqtt:collectd/thin-edge/cpu/percent-active";
			send RawMemMeasurement(timestamp.toString() + ":" + "30.0") to "collectd/thin-edge/mem/percent-used";
			counter := counter + 1.0;
			on wait(1.0) {
				send Trigger() to context.current();
			}
		}
		route Trigger();
		
	}
}