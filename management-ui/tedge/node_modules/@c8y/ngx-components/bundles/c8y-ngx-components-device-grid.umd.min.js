!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@c8y/client"),require("@ngx-translate/core"),require("lodash-es"),require("@c8y/ngx-components"),require("@angular/upgrade/static"),require("@c8y/ngx-components/assets-navigator")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/device-grid",["exports","@angular/core","@c8y/client","@ngx-translate/core","lodash-es","@c8y/ngx-components","@angular/upgrade/static","@c8y/ngx-components/assets-navigator"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"]["device-grid"]={}),e.ng.core,e.client,e.core$1,e.lodashEs,e.c8y["ngx-components"],e.ng.upgrade.static,e.c8y["ngx-components"]["assets-navigator"])}(this,(function(e,t,n,r,i,o,a,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function d(e,t){return function(n,r){t(n,r,e)}}function f(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))}function m(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}var h=function(e){function n(t,n){return e.call(this,"c8ySchemaForm",t,n)||this}return c(n,e),n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Injector}]},p([t.Input()],n.prototype,"schema",void 0),p([t.Input()],n.prototype,"model",void 0),p([t.Input("form")],n.prototype,"inputForm",void 0),p([t.Input("options")],n.prototype,"inputOptions",void 0),n=p([t.Directive({selector:"c8y-schema-form"})],n)}(a.UpgradeComponent),y=function(){function e(e){this.context=e}return e.prototype.ngOnInit=function(){var e=this.context.property;this.schema=i.cloneDeep(e.filteringConfig.schema),this.form=i.cloneDeep(e.filteringConfig.form),this.model=i.cloneDeep(e.externalFilterQuery||{}),this.options={formDefaults:{ngModelOptions:{debounce:100}}}},e.prototype.canApply=function(){return i.get(this.schemaFormComponent,"$componentScope.vm.ngForm.$invalid")},e.prototype.applyFilter=function(){this.context.applyFilter({externalFilterQuery:this.model})},e.prototype.resetFilter=function(){this.context.resetFilter()},e.ctorParameters=function(){return[{type:o.FilteringFormRendererContext}]},p([t.ViewChild(t.forwardRef((function(){return h})),{static:!1})],e.prototype,"schemaFormComponent",void 0),e=p([t.Component({template:'<c8y-schema-form\n  [schema]="schema"\n  [form]="form"\n  [model]="model"\n  [options]="options"\n></c8y-schema-form>\n<div class="data-grid__dropdown__footer d-flex separator-top">\n  <button\n    class="btn btn-default btn-sm m-r-8 flex-grow"\n    (click)="resetFilter()"\n    title="{{ \'Reset\' | translate }}"\n    translate\n  >\n    Reset\n  </button>\n\n  <button\n    class="btn btn-primary btn-sm flex-grow"\n    (click)="applyFilter()"\n    [disabled]="canApply()"\n    title="{{ \'Apply\' | translate }}"\n    translate\n  >\n    Apply\n  </button>\n</div>\n'})],e)}(),v=function(e){void 0===e&&(e={}),this.filteringFormRendererComponent=y,Object.assign(this,e)},_=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:E,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return E}))]}]}]},e=p([t.Component({template:'<a class="listLink"\n  [href]="deviceGridService.getAlarmsHref(context.item)" \n>\n  <small class="status critical text-nowrap"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.critical"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.critical }}\n    <i [c8yIcon]="\'warning\'"></i>\n  </small>\n  <small class="status major text-nowrap"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.major"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.major }}\n    <i [c8yIcon]="\'exclamation-circle\'"></i>\n  </small>\n  <small class="status minor text-nowrap"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.minor"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.minor }}\n    <i [c8yIcon]="\'exclamation-circle\'"></i>\n  </small>\n  <small class="status warning text-nowrap"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.warning"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.warning }}\n    <i [c8yIcon]="\'circle\'"></i>\n  </small>\n</a>\n'}),d(1,t.Inject(t.forwardRef((function(){return E}))))],e)}(),b=function(e){function t(t){var n=e.call(this,t)||this;return n.name="alarms",n.header=o.gettext("Alarms"),n.cellRendererComponent=_,n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{critical:{type:"boolean"},major:{type:"boolean"},minor:{type:"boolean"},warning:{type:"boolean"},none:{type:"boolean"}}},form:[{type:"template",template:"<label><span translate>"+o.gettext("Show devices with active")+"</span>:</label>"},{key:"critical",title:o.gettext("Critical alarms")},{key:"major",title:o.gettext("Major alarms")},{key:"minor",title:o.gettext("Minor alarms")},{key:"warning",title:o.gettext("Warnings")},{key:"none",title:o.gettext("No alarms")}],getFilter:function(e){var t={},n=[];return e.critical&&n.push({"c8y_ActiveAlarmsStatus.critical":{__gt:0}}),e.major&&n.push({"c8y_ActiveAlarmsStatus.major":{__gt:0}}),e.minor&&n.push({"c8y_ActiveAlarmsStatus.minor":{__gt:0}}),e.warning&&n.push({"c8y_ActiveAlarmsStatus.warning":{__gt:0}}),e.none&&(n.push({__not:{__has:"c8y_ActiveAlarmsStatus"}}),n.push({__and:i.map(["critical","major","minor","warning"],(function(e){var t={},n={__not:{__has:void 0}},r="c8y_ActiveAlarmsStatus."+e;return t[r]=0,n.__not.__has=r,{__or:[t,n]}}))})),n.length&&(t.__or=n),t}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:"c8y_ActiveAlarmsStatus.critical"},{path:"c8y_ActiveAlarmsStatus.major"},{path:"c8y_ActiveAlarmsStatus.minor"},{path:"c8y_ActiveAlarmsStatus.warning"}]},n}return c(t,e),t}(v),C=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:E,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return E}))]}]}]},e=p([t.Component({template:'<span\n  title="{{\n    deviceGridService.getParentsNames(\n      context.item,\n      context.property.externalFilterQuery?.deviceGroupId\n    )\n  }}"\n  class="text-truncate"\n>\n  {{\n    deviceGridService.getParentsNames(\n      context.item,\n      context.property.externalFilterQuery?.deviceGroupId\n    )\n  }}\n</span>\n'}),d(1,t.Inject(t.forwardRef((function(){return E}))))],e)}(),S=function(){function e(e){this.context=e,this.preselected=[]}return e.prototype.ngOnInit=function(){var e=this.context.property;this.model=i.cloneDeep(e.externalFilterQuery||{}),this.preselected=this.model.selectedNodes||[]},e.prototype.applyFilter=function(){this.context.applyFilter({externalFilterQuery:this.model})},e.prototype.resetFilter=function(){this.context.resetFilter()},e.prototype.selectionChanged=function(e){this.model.selectedNodes=e},e.ctorParameters=function(){return[{type:o.FilteringFormRendererContext}]},e=p([t.Component({template:'<c8y-asset-selector\n  [selected]="preselected"\n  (onChange)="selectionChanged($event)"\n></c8y-asset-selector>\n\n<div class="data-grid__dropdown__footer d-flex separator-top">\n  <button\n    class="btn btn-default btn-sm m-r-8 flex-grow"\n    (click)="resetFilter()"\n    title="{{ \'Reset\' | translate }}"\n    translate\n  >\n    Reset\n  </button>\n\n  <button\n    class="btn btn-primary btn-sm flex-grow"\n    (click)="applyFilter()"\n    title="{{ \'Apply\' | translate }}"\n    translate\n  >\n    Apply\n  </button>\n</div>\n'})],e)}(),x=function(e){function t(t){var n=e.call(this,t)||this;return n.name="group",n.header=o.gettext("Group"),n.cellRendererComponent=C,n.filteringFormRendererComponent=S,n.filterable=!0,n.filteringConfig={getFilter:function(e){var t={};return e.selectedNodes&&(t.__or=e.selectedNodes.map((function(e){return e.c8y_DeviceQueryString?{__useFilterQueryString:e.c8y_DeviceQueryString}:{__bygroupid:e.id}}))),t}},n.sortable=!1,n}return c(t,e),t}(v),w=function(e){function t(t){var n=e.call(this,t)||this,r=n;return n.path="c8y_Mobile.imei",n.name="imei",n.header=o.gettext("IMEI"),n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{imeis:{type:"array",items:{type:"string"}}}},form:[{key:"imeis",title:o.gettext("Show devices with IMEI"),add:o.gettext("Or"),items:[{key:"imeis[]",notitle:!0,placeholder:o.gettext("e.g. 46543432321, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.imeis.length&&(t[r.path]={__in:e.imeis}),t}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:n.path}]},n}return c(t,e),t}(v),D=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:E,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return E}))]}]}]},e=p([t.Component({template:"\n    {{ deviceGridService.getModel(context.item) }}\n  "}),d(1,t.Inject(t.forwardRef((function(){return E}))))],e)}(),A=function(e){function t(t){var n=e.call(this,t)||this,r="com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.model";return n.name="model",n.header=o.gettext("Model"),n.cellRendererComponent=D,n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{models:{type:"array",items:{type:"string"}}}},form:[{key:"models",title:o.gettext("Show devices with model"),add:o.gettext("Or"),items:[{key:"models[]",notitle:!0,placeholder:o.gettext("e.g. ModelName, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t,n={};return e.models.length&&(n.__or=((t={})["c8y_Hardware.model"]={__in:e.models},t[r]={__in:e.models},t)),n}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:"c8y_Hardware.model"},{path:r}]},n}return c(t,e),t}(v),I=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:E,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return E}))]}]}]},e=p([t.Component({template:'\n    <a\n      [href]="deviceGridService.getHref(context.item)"\n      title="{{ deviceGridService.getProperName(context.item) }}"\n      class="interact"\n    >\n      {{ deviceGridService.getProperName(context.item) }}\n    </a>\n  '}),d(1,t.Inject(t.forwardRef((function(){return E}))))],e)}(),G=function(e){function t(t){var n=e.call(this,t)||this;return n.name="name",n.path="name",n.header=o.gettext("Name"),n.cellCSSClassName="data-record-header",n.cellRendererComponent=I,n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{names:{type:"array",items:{type:"string"}}}},form:[{key:"names",title:o.gettext("Show devices with name"),add:o.gettext("Or"),items:[{key:"names[]",notitle:!0,placeholder:o.gettext("e.g. My Device, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.names.length&&(t.name={__in:e.names}),t}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:n.path}]},n}return c(t,e),t}(v),O=function(){function e(e){this.context=e}return e.ctorParameters=function(){return[{type:o.CellRendererContext}]},e=p([t.Component({template:"\n    {{ context.value | c8yDate }}\n  "})],e)}(),k=function(e){function t(t){var n=e.call(this,t)||this,r=n;return n.path="creationTime",n.name="registrationDate",n.header=o.gettext("Registration date"),n.cellRendererComponent=O,n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{registrationDate:{type:"object",properties:{after:{type:"string",format:"datetime"},before:{type:"string",format:"datetime"}}}}},form:[{key:"registrationDate.after",title:o.gettext("Show devices registered after"),maxDateKey:"registrationDate.before"},{key:"registrationDate.before",title:o.gettext("And before`date`"),minDateKey:"registrationDate.after"}],getFilter:function(e){var t,n,i={},o=e&&e.registrationDate;if(o&&(o.after||o.before)){if(i.__and=[],o.after){var a=r.formatDate(o.after);i.__and.push({__or:(t={},t[r.path]={__gt:a},t[r.path+".date"]={__gt:a},t)})}if(o.before){var s=r.formatDate(o.before);i.__and.push({__or:(n={},n[r.path]={__lt:s},n[r.path+".date"]={__lt:s},n)})}}return i}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:n.path+".date"},{path:n.path}]},n}return c(t,e),t.prototype.formatDate=function(e){return new Date(e).toISOString()},t}(v),F=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:E,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return E}))]}]}]},e=p([t.Component({template:"\n    {{ deviceGridService.getSerialNumber(context.item) }}\n  "}),d(1,t.Inject(t.forwardRef((function(){return E}))))],e)}(),R=function(e){function t(t){var n=e.call(this,t)||this;return n.name="serialNumber",n.header=o.gettext("Serial number"),n.cellRendererComponent=F,n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{serialNumbers:{type:"array",items:{type:"string"}}}},form:[{key:"serialNumbers",title:o.gettext("Show devices with serial number"),add:o.gettext("Or"),items:[{key:"serialNumbers[]",notitle:!0,placeholder:o.gettext("e.g. 54321-123, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t,n={};return e.serialNumbers.length&&(n.__or=((t={})["c8y_Hardware.serialNumber"]={__in:e.serialNumbers},t["com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial"]={__in:e.serialNumbers},t)),n}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:"c8y_Hardware.serialNumber"},{path:"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial"}]},n}return c(t,e),t}(v),N=function(){function e(e){this.context=e}return e.ctorParameters=function(){return[{type:o.CellRendererContext}]},e=p([t.Component({template:'\n    <device-status [mo]="context.item"></device-status>\n  '})],e)}(),j=function(e){function t(){var t,n,r,i,a,s,l,c=e.call(this)||this,u=((t={})["c8y_RequiredAvailability.responseInterval"]={__le:0},t),p={__not:{__has:"c8y_RequiredAvailability.responseInterval"}},d=((n={})["c8y_Availability.status"]=o.SendStatus.AVAILABLE,n),f=((r={})["c8y_Availability.status"]=o.SendStatus.UNAVAILABLE,r),m=((i={})["c8y_Availability.status"]=o.SendStatus.MAINTENANCE,i),g={__not:{__has:"c8y_Availability.status"}},h=((a={})["c8y_Connection.status"]=o.PushStatus.CONNECTED,a),y=((s={})["c8y_Connection.status"]=o.PushStatus.DISCONNECTED,s),v=((l={})["c8y_Connection.status"]=o.PushStatus.MAINTENANCE,l),_={__or:[u,m,v]},b={__and:[{__not:u},{__not:m},{__not:v}]};return c.name="status",c.header=o.gettext("Status"),c.dataType="icon",c.cellRendererComponent=N,c.filterable=!0,c.filteringConfig={schema:{type:"object",properties:{sendOnline:{type:"boolean"},sendOffline:{type:"boolean"},sendUnknown:{type:"boolean"},sendNotMonitored:{type:"boolean"},pushOnline:{type:"boolean"},pushOffline:{type:"boolean"},pushNotMonitored:{type:"boolean"},maintenance:{type:"boolean"}}},form:[{type:"template",template:"<label><span translate>"+o.gettext("Show devices with send status")+"</span>:</label>"},{key:"sendOnline",title:o.gettext("Online")},{key:"sendOffline",title:o.gettext("Offline")},{key:"sendUnknown",title:o.gettext("Unknown")},{key:"sendNotMonitored",title:o.gettext("Not monitored")},{type:"template",template:"<label><span translate>"+o.gettext("Show devices with push status")+"</span>:</label>"},{key:"pushOnline",title:o.gettext("Online")},{key:"pushOffline",title:o.gettext("Offline")},{key:"pushNotMonitored",title:o.gettext("Not monitored")},{type:"template",template:"<label><span translate>"+o.gettext("Show devices with maintenance status")+"</span>:</label>"},{key:"maintenance",title:o.gettext("Device is under maintenance")}],getFilter:function(e){var t={},n=[];return e&&(e.sendOnline&&n.push({__and:[b,d]}),e.sendOffline&&n.push({__and:[b,f]}),e.sendUnknown&&n.push({__and:[b,g]}),(e.sendNotMonitored||e.pushNotMonitored)&&n.push(p),e.pushOnline&&n.push({__and:[b,h]}),e.pushOffline&&n.push({__and:[b,y]}),e.maintenance&&n.push(_),n.length&&(t.__or=n)),t}},c.sortable=!0,c.sortingConfig={pathSortingConfigs:[{path:"c8y_Availability.status"}]},c}return c(t,e),t}(v),P=function(e){function t(t){var n=e.call(this,t)||this,r=n;return n.path="id",n.name="systemId",n.header=o.gettext("System ID"),n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{ids:{type:"array",items:{type:"string"}}}},form:[{key:"ids",title:o.gettext("Show devices with system ID"),add:o.gettext("Or"),items:[{key:"ids[]",notitle:!0,placeholder:o.gettext("e.g. 10300, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.ids.length&&(t[r.path]={__in:e.ids}),t}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:n.path}]},n}return c(t,e),t}(v),E=function(){function e(e,t){this.inventoryService=e,this.translateService=t,this.GRID_CONFIG_DEFAULT_STORAGE_KEY="device-grid-config",this.DEFAULT_PAGE_SIZE=20,this.queriesUtil=new n.QueriesUtil}return e.prototype.getDefaultColumns=function(){return[new j,new G,new A,new R,new x,new k,new P,new w,new b]},e.prototype.getDefaultPagination=function(){return{pageSize:10,currentPage:1}},e.prototype.getInfiniteScrollPagination=function(){return{pageSize:50,currentPage:1}},e.prototype.getDefaultActionControls=function(){var e=this;return[{type:"DELETE",callback:function(t){return e.delete(t)}}]},e.prototype.getDefaultBulkActionControls=function(){return[]},e.prototype.getProperName=function(e){var t=e.id,n=e.name;return n||this.translateService.instant("Device {{id}}",{id:t})},e.prototype.getModel=function(e){var t=this.getHardware(e);return t&&t.model},e.prototype.getSerialNumber=function(e){var t=this.getHardware(e),n=this.isVendme(e)?"serial":"serialNumber";return t&&t[n]},e.prototype.getParentsNames=function(e,t){var n=e.assetParents.references,r=i.map(n,"managedObject"),o=i.sortBy(r,["name"]),a=i.remove(o,{id:t}).concat(o);return i.map(a,"name").join(", ")},e.prototype.getHref=function(e,t){return void 0===t&&(t="#/"),e.c8y_IsDeviceGroup||e.c8y_IsDynamicGroup?t+"group/"+e.id:t+"device/"+e.id},e.prototype.getAlarmsHref=function(e){return this.getHref(e)+"/alarms"},e.prototype.getUserConfiguredColumns=function(e){var t=this.getConfig();if(t.columns.length>0){var n=[],r=[];try{r=e.filter((function(e){return!t.columns.includes(e)})),t.columns.forEach((function(t){var r=t.visible,i=t.name,o=t.sortOrder,a=e.find((function(e){return e.name===i}));a&&(a.visible=r,a.sortOrder=o,n.push(a))}))}catch(e){this.clearConfig()}return function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}(n,r)}return e},e.prototype.delete=function(e){console.log("should delete",e)},e.prototype.getData=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=!1),f(this,void 0,void 0,(function(){var i;return m(this,(function(o){return i=u({},this.getDevicesFilters(e,t,n),{withParents:!0,withChildren:r}),[2,this.inventoryService.list(i)]}))}))},e.prototype.getCount=function(e,t,n){return void 0===n&&(n={}),f(this,void 0,void 0,(function(){var r;return m(this,(function(i){switch(i.label){case 0:return r=u({},this.getDevicesFilters(e,t,n),{pageSize:1,currentPage:1}),[4,this.inventoryService.list(r)];case 1:return[2,i.sent().paging.totalPages]}}))}))},e.prototype.getTotal=function(e){return void 0===e&&(e={}),f(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t={q:this.queriesUtil.buildQuery(e),pageSize:1,withTotalPages:!0},[4,this.inventoryService.list(t)];case 1:return[2,n.sent().paging.totalPages]}}))}))},e.prototype.getDeviceQueryString=function(e,t){var n=this.getQueryObj(e);return n=this.queriesUtil.addAndFilter(n,t),this.queriesUtil.buildQuery(n)},e.prototype.getQueryObj=function(e,t){var n=this;return void 0===t&&(t={}),i.transform(e,(function(e,t){return n.extendQueryByColumn(e,t)}),u({__filter:{},__orderby:[]},t))},e.prototype.getConfig=function(e){void 0===e&&(e=this.GRID_CONFIG_DEFAULT_STORAGE_KEY);var t=JSON.parse(localStorage.getItem(e));return null===t?{columns:[],pagination:{pageSize:this.DEFAULT_PAGE_SIZE,currentPage:1}}:t},e.prototype.saveConfig=function(e,t){void 0===t&&(t=this.GRID_CONFIG_DEFAULT_STORAGE_KEY),localStorage.setItem(t,JSON.stringify(e))},e.prototype.clearConfig=function(e){void 0===e&&(e=this.GRID_CONFIG_DEFAULT_STORAGE_KEY),localStorage.removeItem(e)},e.prototype.getHardware=function(e){var t=this.isVendme(e)?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware";return e&&e[t]},e.prototype.isVendme=function(e){return"com_nsn_startups_vendme_VendingMachine"===e.type},e.prototype.getDevicesFilters=function(e,t,n){return{q:this.getDeviceQueryString(e,n),pageSize:t.pageSize,currentPage:t.currentPage,withChildren:!1,withTotalPages:!0}},e.prototype.extendQueryByColumn=function(e,t){if(t.filterable&&t.externalFilterQuery){var n=(t.filteringConfig.getFilter||i.identity)(t.externalFilterQuery);n.__or?(e.__filter.__and=e.__filter.__and||[],e.__filter.__and.push(n)):n.__and&&i.get(e,"__filter.__and")?n.__and.map((function(t){return e.__filter.__and.push(t)})):i.assign(e.__filter,n)}if(t.sortable&&t.sortOrder){var r={};i.forEach(t.sortingConfig.pathSortingConfigs,(function(e){r[e.path]=("asc"===t.sortOrder?1:-1)*(e.sortOrderModifier||1)})),e.__orderby.push(r)}return e},e.ctorParameters=function(){return[{type:n.InventoryService},{type:r.TranslateService}]},e=p([t.Injectable()],e)}(),M=function(){function e(e){this.deviceGridService=e,this.title=o.gettext("Devices"),this.loadMoreItemsLabel=o.gettext("Load more devices"),this.loadingItemsLabel=o.gettext("Loading devices…"),this.selectable=!1,this.baseQuery={},this.showChildDevices={},this.onColumnsChange=new t.EventEmitter,this.onDeviceQueryStringChange=new t.EventEmitter,this.itemsSelect=new t.EventEmitter,this.onChildDevices=new t.EventEmitter,this.columns=this.deviceGridService.getDefaultColumns(),this.pagination=this.deviceGridService.getDefaultPagination(),this.actionControls=this.deviceGridService.getDefaultActionControls(),this.bulkActionControls=this.deviceGridService.getDefaultBulkActionControls(),this.withChildren=!1,this.serverSideDataCallback=this.onDataSourceModifier.bind(this)}return Object.defineProperty(e.prototype,"_columns",{set:function(e){this.columns=e?this.deviceGridService.getUserConfiguredColumns(e):this.deviceGridService.getUserConfiguredColumns(this.deviceGridService.getDefaultColumns())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_pagination",{set:function(e){this.pagination=e||this.deviceGridService.getDefaultPagination()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_infiniteScroll",{set:function(e){this.infiniteScroll=e,this.pagination=this.deviceGridService.getInfiniteScrollPagination()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_actionControls",{set:function(e){this.actionControls=e||this.deviceGridService.getDefaultActionControls()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_bulkActionControls",{set:function(e){this.bulkActionControls=e||this.deviceGridService.getDefaultBulkActionControls()},enumerable:!0,configurable:!0}),e.prototype.trackByName=function(e,t){return t.name},e.prototype.onDataSourceModifier=function(e){return f(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return m(this,(function(l){switch(l.label){case 0:return[4,this.deviceGridService.getData(e.columns,e.pagination,this.baseQuery,this.withChildren)];case 1:return n=l.sent(),r=n.res,i=n.data,o=n.paging,[4,this.deviceGridService.getCount(e.columns,e.pagination,this.baseQuery)];case 2:return a=l.sent(),[4,this.deviceGridService.getTotal(this.baseQuery)];case 3:return s=l.sent(),this.onColumnsChange.emit(e.columns),this.onDeviceQueryStringChange.emit(this.deviceGridService.getDeviceQueryString(e.columns,this.baseQuery)),t={res:r,data:i,paging:o,filteredSize:a,size:s},this.dataCallback&&(t=this.dataCallback(t)),[2,t]}}))}))},e.prototype.updateFiltering=function(e,t){t.type===o.FilteringActionType.ResetFilter?this.dataGrid.clearFilters():this.dataGrid.updateFiltering(e,t)},e.prototype.configChange=function(e){this.deviceGridService.saveConfig(e)},e.ctorParameters=function(){return[{type:E}]},p([t.Input()],e.prototype,"dataCallback",void 0),p([t.Input()],e.prototype,"refresh",void 0),p([t.Input()],e.prototype,"title",void 0),p([t.Input()],e.prototype,"itemsSelectLimit",void 0),p([t.Input()],e.prototype,"loadMoreItemsLabel",void 0),p([t.Input()],e.prototype,"loadingItemsLabel",void 0),p([t.Input("columns")],e.prototype,"_columns",null),p([t.Input("pagination")],e.prototype,"_pagination",null),p([t.Input("infiniteScroll")],e.prototype,"_infiniteScroll",null),p([t.Input("actionControls")],e.prototype,"_actionControls",null),p([t.Input()],e.prototype,"selectable",void 0),p([t.Input()],e.prototype,"baseQuery",void 0),p([t.Input("bulkActionControls")],e.prototype,"_bulkActionControls",null),p([t.Input()],e.prototype,"showChildDevices",void 0),p([t.Output()],e.prototype,"onColumnsChange",void 0),p([t.Output()],e.prototype,"onDeviceQueryStringChange",void 0),p([t.Output()],e.prototype,"itemsSelect",void 0),p([t.Output()],e.prototype,"onChildDevices",void 0),p([t.ViewChild(o.DataGridComponent,{static:!0})],e.prototype,"dataGrid",void 0),e=p([t.Component({selector:"c8y-device-grid",template:'<c8y-data-grid\n  [title]="title"\n  [loadMoreItemsLabel]="loadMoreItemsLabel"\n  [loadingItemsLabel]="loadingItemsLabel"\n  [columns]="columns"\n  [pagination]="pagination"\n  [infiniteScroll]="infiniteScroll"\n  [actionControls]="actionControls"\n  [selectable]="selectable"\n  [bulkActionControls]="bulkActionControls"\n  [serverSideDataCallback]="serverSideDataCallback"\n  [itemsSelectLimit]="itemsSelectLimit"\n  (itemsSelect)="itemsSelect.emit($event)"\n  (onConfigChange)="configChange($event)"\n  [refresh]="refresh"\n  [showChildDevices]="showChildDevices"\n  (onChildDevices)="withChildren=$event;onChildDevices.emit($event)"\n>\n  <div class="c8y-empty-state">\n    <h1 c8yIcon="search"></h1>\n    <div>\n      <p>\n        <strong>{{ \'No matching devices.\' | translate }}</strong>\n      </p>\n      <small>{{ \'Refine your search terms\' | translate }}</small>\n    </div>\n  </div>\n  <ng-container *ngFor="let column of columns; trackBy: trackByName">\n    <c8y-column [name]="column.name"></c8y-column>\n  </ng-container>\n</c8y-data-grid>\n'})],e)}(),T=function(){function e(){}return e=p([t.NgModule({imports:[o.CommonModule,o.FormsModule,o.DeviceStatusModule,o.DataGridModule,s.AssetSelectorModule],declarations:[M,y,S,N,I,D,F,C,O,_,h],exports:[M,y,S,N,I,D,F,C,O,_,h],entryComponents:[M,y,S,N,I,D,F,C,O,_],providers:[E]})],e)}(),Q=function(e){function t(t){var n=e.call(this,t)||this,r=n;return n.name="custom",n.header=o.gettext("Custom"),n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{exists:{type:"boolean",default:!1,title:o.gettext("Only rows where value is defined")},equals:{type:"array",items:{type:"string"}}}},form:[{key:"exists"},{key:"equals",title:o.gettext("Only rows where value equals to:"),add:o.gettext("Or"),items:[{key:"equals[]",notitle:!0,placeholder:o.gettext("e.g. value, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.exists&&(t.__has=r.path),e.equals&&(t[r.path]={__in:e.equals}),t}},n.sortable=!0,n}return c(t,e),Object.defineProperty(t.prototype,"sortingConfig",{get:function(){return{pathSortingConfigs:[{path:this.path}]}},enumerable:!0,configurable:!0}),t}(v),L=function(e){function t(t){var n=e.call(this,t)||this;return n.name="type",n.path="type",n.header=o.gettext("Type"),n.filterable=!0,n.filteringConfig={schema:{type:"object",properties:{types:{type:"array",items:{type:"string"}}}},form:[{key:"types",title:o.gettext("Show devices with type"),add:o.gettext("Or"),items:[{key:"types[]",notitle:!0,placeholder:o.gettext("e.g. MyType, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.types.length&&(t.type={__in:e.types}),t}},n.sortable=!0,n.sortingConfig={pathSortingConfigs:[{path:"type"}]},n}return c(t,e),t}(v);e.AlarmsCellRendererComponent=_,e.AlarmsDeviceGridColumn=b,e.BaseDeviceGridColumn=v,e.BaseFilteringFormRendererComponent=y,e.CustomDeviceGridColumn=Q,e.DeviceGridComponent=M,e.DeviceGridModule=T,e.DeviceGridService=E,e.GroupCellRendererComponent=C,e.GroupDeviceGridColumn=x,e.GroupFilteringFormRendererComponent=S,e.ImeiDeviceGridColumn=w,e.ModelCellRendererComponent=D,e.ModelDeviceGridColumn=A,e.NameCellRendererComponent=I,e.NameDeviceGridColumn=G,e.RegistrationDateCellRendererComponent=O,e.RegistrationDateDeviceGridColumn=k,e.SchemaFormComponent=h,e.SerialNumberCellRendererComponent=F,e.SerialNumberDeviceGridColumn=R,e.StatusCellRendererComponent=N,e.StatusDeviceGridColumn=j,e.SystemIdDeviceGridColumn=P,e.TypeDeviceGridColumn=L,e.ɵa=y,e.ɵb=S,e.ɵc=N,e.ɵd=I,e.ɵe=D,e.ɵf=F,e.ɵg=C,e.ɵh=O,e.ɵi=_,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-device-grid.umd.min.js.map