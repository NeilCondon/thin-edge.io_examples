!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@c8y/ngx-components/sub-assets"),require("lodash-es"),require("@angular/router"),require("@c8y/client"),require("@c8y/ngx-components"),require("@c8y/ngx-components/device-grid"),require("rxjs"),require("rxjs/operators"),require("ngx-bootstrap/dropdown"),require("ngx-bootstrap/modal")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/search",["exports","@angular/core","@c8y/ngx-components/sub-assets","lodash-es","@angular/router","@c8y/client","@c8y/ngx-components","@c8y/ngx-components/device-grid","rxjs","rxjs/operators","ngx-bootstrap/dropdown","ngx-bootstrap/modal"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"].search={}),e.ng.core,e.c8y["ngx-components"]["sub-assets"],e.lodashEs,e.ng.router,e.client,e.c8y["ngx-components"],e.c8y["ngx-components"]["device-grid"],e.rxjs,e.rxjs.operators,e.dropdown,e.modal)}(this,(function(e,t,n,r,i,s,o,a,c,l,u,p){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function y(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function f(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function m(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var g=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.GRID_CONFIG_STORAGE_KEY="search-grid-config",t.DEFAULT_PAGE_SIZE=50,t.FRAGMENTS_FOR_NO_DEVICE=["c8y_Dashboard","c8y_Report","c8y_Kpi","c8y_ExportConfiguration","c8y_IsBinary","c8y_NoDevice","c8y_IsDeviceGroup","c8y_Group","com_cumulocity_model_smartrest_SmartRestTemplate","com_cumulocity_model_devicesimulator_SensorTemplate","_attachments","c8y_IsDeviceType","c8y_objectmapping_ObjectMapping"],t.TYPES_FOR_NO_DEVICE=["c8y_ConfigurationDump","c8y_Firmware","c8y_SmartRule","c8y_Software","impact_object_mapping","c8y_UserPreference","c8y_TenantPolicy","c8y_PrivateSmartRule","c8y_SmartRest2Template","c8y_JsonSchema","c8y_DeviceShellTemplate","c8y_DemoStatus","c8y_DataBroker","c8y_Application_","brandingVariables","c8y_DeviceSimulator","c8y_CertificateMetadata","lwm2m_post_registration","c8y_microservice_manifest_","c8y_CepAgent"],t.DEVICE_FRAGMENT_TYPE="c8y_IsDevice",t}return function(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,e),n.prototype.filterOnlyAssets=function(e){var t=this;return e.filter((function(e){return e.c8y_IsDeviceGroup||t.isAnyDevice(e)}))},n.prototype.buildCombinedRootQueryFilter=function(e,t){var n=this.getQueryObj(e,t),r=this.queriesUtil.addOrderbys({__filter:{__and:{__not:{__has:"c8y_IsBinary"}}}},n.__orderby,"append"),i=this.queriesUtil.addAndFilter(r,n.__filter);return this.queriesUtil.buildQuery(i)},n.prototype.search=function(e){return this.inventoryService.list({text:e,withTotalPages:!0,pageSize:this.DEFAULT_PAGE_SIZE,withChildren:!1})},n.prototype.isRootDevice=function(e){return!!e[this.DEVICE_FRAGMENT_TYPE]},n.prototype.isAnyDevice=function(e){return this.isRootDevice(e)||!this.hasFragmentOrTypeFromBlacklist(e)},n.prototype.hasFragmentOrTypeFromBlacklist=function(e){return this.hasTypeFromBlacklist(e)||this.hasFragmentFromBlacklist(e)},n.prototype.hasTypeFromBlacklist=function(e){var t=r.get(e,"type","");return r.some(this.TYPES_FOR_NO_DEVICE,(function(e){return t.includes(e)}))},n.prototype.hasFragmentFromBlacklist=function(e){return r.find(this.FRAGMENTS_FOR_NO_DEVICE,(function(t){return!r.isUndefined(e[t])}))},n=y([t.Injectable()],n)}(n.SubAssetsService),v=function(){function e(e,t,n,r){var i=this;this.router=e,this.inventory=t,this.deviceGridService=n,this.searchService=r,this.term="",this.filterPipe=c.pipe(l.map((function(e){return i.searchService.filterOnlyAssets(e)}))),this.recentSearchResults=[],this.isLoading=!1,this.noMatch=!1,this.RECENT_SEARCH_STORAGE_KEY="recent_search_view",this.MAX_RECENT_SEARCH_RESULTS=5,this.DEFAULT_FILTER={withTotalPages:!0,pageSize:5,withChildren:!1},this.KEYCODE_ENTER=13,this.KEYCODE_ESC=27}return e.prototype.ngOnInit=function(){return f(this,void 0,void 0,(function(){var e,t,n=this;return m(this,(function(r){switch(r.label){case 0:return(e=JSON.parse(localStorage.getItem(this.RECENT_SEARCH_STORAGE_KEY)))&&e.length>0?[4,this.inventory.list({ids:e.join(",")})]:[3,2];case 1:t=r.sent().data,this.recentSearchResults=t,this.recentlyRegisteredResults$=c.defer((function(){return n.inventory.list(d({q:"$orderby=creationTime desc"},n.DEFAULT_FILTER))})),r.label=2;case 2:return[2]}}))}))},e.prototype.onOpenChange=function(e){var t=this;e&&requestAnimationFrame((function(){t.subscribeOnSearch(),t.typeahead.dropdown.show(),t.typeahead.searchControl.nativeElement.focus()}))},e.prototype.open=function(e,t){e.stopPropagation(),this.recentSearchResults.find((function(e){return e.id===t.id}))||(this.recentSearchResults.unshift(t),this.recentSearchResults=this.recentSearchResults.slice(0,this.MAX_RECENT_SEARCH_RESULTS));var n=this.recentSearchResults.map((function(e){return e.id}));localStorage.setItem(this.RECENT_SEARCH_STORAGE_KEY,JSON.stringify(n)),this.router.navigateByUrl(this.deviceGridService.getHref(t,"/")),this.dropdown.hide()},e.prototype.reset=function(){this.typeahead.onSearch.emit(""),this.selected=void 0,this.typeahead.searchControl.nativeElement.focus()},e.prototype.keyDown=function(e){var t=e.keyCode;if(t===this.KEYCODE_ENTER){var n=e.target.value;this.navigate(["/assetsearch"],{queryParams:{search:n}}),this.dropdown.hide()}else t===this.KEYCODE_ESC&&(""===this.term&&this.dropdown.hide(),this.reset())},e.prototype.filter=function(e){this.navigate(["/assetsearch"],{queryParams:{filter:e}}),this.dropdown.hide()},e.prototype.openSearch=function(){this.router.navigateByUrl("/assetsearch"),this.dropdown.hide()},e.prototype.subscribeOnSearch=function(){var e=this;this.results$||(this.results$=this.typeahead.onSearch.pipe(l.tap((function(t){return e.onTypingStarted(t)})),l.switchMap((function(t){return e.mergeRequest(t)}))))},e.prototype.navigate=function(e,t){var n=this;this.router.navigateByUrl("/",{skipLocationChange:!0}).then((function(){return n.router.navigate(e,t)}))},e.prototype.mergeRequest=function(e){var t=this;return c.merge(c.of({data:[]}),this.queryInventoryService(e).pipe(l.tap((function(e){var n=e.data,r=e.paging;return t.onLoadingDone(n,r)}))))},e.prototype.queryInventoryService=function(e){var t=this;return e?c.defer((function(){return t.searchService.search(e)})):c.empty()},e.prototype.onLoadingDone=function(e,t){this.isLoading=!1,this.noMatch=t&&null===t.nextPage&&0===this.searchService.filterOnlyAssets(e).length},e.prototype.onTypingStarted=function(e){this.noMatch=!1,this.term=e,this.isLoading=e.length>0},e.ctorParameters=function(){return[{type:i.Router},{type:s.InventoryService},{type:a.DeviceGridService},{type:g}]},y([t.ViewChild(o.TypeaheadComponent,{static:!1})],e.prototype,"typeahead",void 0),y([t.ViewChild("dropdown",{static:!1})],e.prototype,"dropdown",void 0),e=y([t.Component({selector:"c8y-search-box",template:'<div\n  class="dropdown"\n  dropdown\n  #dropdown="bs-dropdown"\n  [insideClick]="true"\n  (isOpenChange)="onOpenChange($event)"\n>\n  <button\n    class="main-header-button dropdown-toggle c8y-dropdown"\n    dropdownToggle\n    type="button"\n    title="Search"\n    aria-controls="searchDropdown"\n  >\n    <i c8yIcon="search" class="icon-2x"></i>\n  </button>\n\n  <div\n    id="searchDropdown"\n    *dropdownMenu\n    class="search-header-menu dropdown-menu dropdown-menu-center"\n  >\n    <form novalidate #searchForm="ngForm" class="c8y-search-form">\n      <c8y-typeahead\n        [(ngModel)]="selected"\n        placeholder="{{ \'Search for groups or assets…\' | translate }}"\n        (keydown)="keyDown($event)"\n        (onIconClick)="reset()"\n        [icon]="term ? \'times\' : \'search\'"\n        [allowFreeEntries]="false"\n        name="selected"\n      >\n        \x3c!-- filter buttons --\x3e\n        <c8y-li *ngIf="term.length !== 0" class="p-l-16 p-r-16">\n          <div class="flex-row">\n            <p class="m-r-4 text-muted">\n              <em translate>Searching by exact match. Click for other search options:</em>\n            </p>\n            <div class="btn-group btn-group-sm">\n              <button\n                class="btn btn-default"\n                title="{{ \'Starts with\' | translate }}"\n                (click)="filter(term + \'*\')"\n              >\n                {{ \'Starts with\' | translate }}\n              </button>\n              <button\n                class="btn btn-default"\n                title="{{ \'Contains\' | translate }}"\n                (click)="filter(\'*\' + term + \'*\')"\n              >\n                {{ \'Contains\' | translate }}\n              </button>\n              <button\n                class="btn btn-default"\n                title="{{ \'Ends with\' | translate }}"\n                (click)="filter(\'*\' + term)"\n              >\n                {{ \'Ends with\' | translate }}\n              </button>\n            </div>\n          </div>\n        </c8y-li>\n\n        \x3c!-- Recent search --\x3e\n        <c8y-li\n          *ngIf="term.length === 0 && recentSearchResults.length > 0"\n          [selectable]="false"\n          class="p-l-24 p-r-24"\n        >\n          <div class="legend form-block">\n            <span translate>Recent search results</span>\n          </div>\n        </c8y-li>\n        <c8y-li\n          *ngFor="let result of term.length === 0 ? recentSearchResults : []"\n          class="c8y-list__item--link m-l-16 m-r-16"\n          (click)="open($event, result)"\n        >\n          <c8y-li-icon>\n            <device-status [mo]="result" *ngIf="!result.c8y_IsDeviceGroup"></device-status>\n            <i\n              [c8yIcon]="\'c8y-group-open\'"\n              class="c8y-icon-duocolor"\n              *ngIf="result.c8y_IsDeviceGroup"\n            ></i>\n          </c8y-li-icon>\n          {{ result.name || \'--\' }}\n        </c8y-li>\n\n        \x3c!-- Recently registered devices --\x3e\n        <c8y-li\n          *ngIf="term.length === 0 && (recentlyRegisteredResults$ | async)?.data?.length > 0"\n          class="p-l-24 p-r-24"\n          [selectable]="false"\n        >\n          <div class="legend form-block">\n            <span translate>Recently registered devices</span>\n          </div>\n        </c8y-li>\n        <c8y-li\n          *c8yFor="\n            let result of term.length === 0 ? recentlyRegisteredResults$ : { data: [] };\n            loadMore: \'none\';\n            pipe: filterPipe\n          "\n          class="c8y-list__item--link m-l-16 m-r-16"\n          (click)="open($event, result)"\n        >\n          <c8y-li-icon>\n            <device-status [mo]="result" *ngIf="!result.c8y_IsDeviceGroup"></device-status>\n            <i\n              [c8yIcon]="\'c8y-group-open\'"\n              class="c8y-icon-duocolor"\n              *ngIf="result.c8y_IsDeviceGroup"\n            ></i>\n          </c8y-li-icon>\n          {{ result.name || \'--\' }}\n        </c8y-li>\n\n        \x3c!-- Search results --\x3e\n        <c8y-li *ngIf="term.length !== 0" class="p-l-24 p-r-24" [selectable]="false">\n          <div class="legend form-block">\n            <span translate>Search results</span>\n          </div>\n        </c8y-li>\n        <c8y-li\n          *c8yFor="\n            let result of results$;\n            loadMore: \'auto\';\n            pipe: filterPipe;\n            notFound: notFoundTemplate;\n            loadingTemplate: loading;\n            loadNextLabel: \'Find more…\'\n          "\n          class="c8y-list__item--link  m-l-16 m-r-16"\n          (click)="open($event, result)"\n        >\n          <c8y-li-icon>\n            <device-status [mo]="result" *ngIf="!result.c8y_IsDeviceGroup"></device-status>\n            <i\n              [c8yIcon]="\'c8y-group-open\'"\n              class="c8y-icon-duocolor"\n              *ngIf="result.c8y_IsDeviceGroup"\n            ></i>\n          </c8y-li-icon>\n          {{ result.name || \'--\' }}\n        </c8y-li>\n\n        \x3c!-- No search results found entry --\x3e\n        <ng-template #notFoundTemplate>\n          <c8y-li *ngIf="noMatch" class="p-16 c8y-empty-state" [selectable]="false">\n            <c8y-li-icon [icon]="\'search\'"></c8y-li-icon>\n            <p><strong translate>No match found.</strong></p>\n            <small translate>\n              Use a filter or go to the asset data table to show all devices and groups.\n            </small>\n          </c8y-li>\n        </ng-template>\n\n        \x3c!-- loading bar first entries --\x3e\n        <c8y-li *ngIf="isLoading" class="p-t-32 p-b-0 p-relative">\n          <div class="spinner" style="right:0;">\n            <div class="rect1"></div>\n            <div class="rect2"></div>\n            <div class="rect3"></div>\n            <div class="rect4"></div>\n            <div class="rect5"></div>\n          </div>\n        </c8y-li>\n\n        \x3c!-- loading bar for loading more entries (inventory roles) --\x3e\n        <ng-template #loading>\n          <c8y-li class="text-center p-t-32 p-b-0 p-relative">\n            <div class="spinner" style="right:0;">\n              <div class="rect1"></div>\n              <div class="rect2"></div>\n              <div class="rect3"></div>\n              <div class="rect4"></div>\n              <div class="rect5"></div>\n            </div>\n          </c8y-li>\n        </ng-template>\n\n        \x3c!-- more filter possibilities --\x3e\n        <c8y-li class="m-t-24 bg-gray-lighter p-t-16 p-b-16 p-l-24 p-r-24" [selectable]="false">\n          <div class="flex-row">\n            <i c8yIcon="info-circle" class="text-info m-r-4"></i>\n            <p translate class="m-r-8">Need more filter possibilities?</p>\n            <button\n              type="button"\n              class="m-l-auto btn btn-default btn-sm"\n              translate\n              (mousedown)="openSearch()"\n            >\n              Go to the asset data table\n            </button>\n          </div>\n        </c8y-li>\n      </c8y-typeahead>\n    </form>\n  </div>\n</div>\n'})],e)}(),b=function(){function e(e,n,r,i){this.searchService=e,this.bsModalService=n,this.smartGroupsService=r,this.subAssetsGridService=i,this.title="",this.loadingItemsLabel=o.gettext("Loading results…"),this.selectable=!1,this.onColumnsChange=new t.EventEmitter,this.searchText="",this.pagination=this.searchService.getDefaultPagination(),this.bulkActionControls=this.searchService.getDefaultBulkActionControls(),this.refresh=new t.EventEmitter,this.sizeCount=0}return Object.defineProperty(e.prototype,"_columns",{set:function(e){this.columns=e||this.searchService.getDefaultColumns()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_pagination",{set:function(e){this.pagination=e||this.searchService.getDefaultPagination()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_actionControls",{set:function(e){this.actionControls=e||this.searchService.getDefaultActionControls()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_bulkActionControls",{set:function(e){this.bulkActionControls=e||this.searchService.getDefaultBulkActionControls()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.filteringName?this.columns=[new n.AssetTypeGridColumn({sortOrder:"desc"}),new a.NameDeviceGridColumn({sortOrder:"asc",filter:{externalFilterQuery:{names:[this.filteringName]}}}),new a.ModelDeviceGridColumn,new a.SerialNumberDeviceGridColumn({visible:!1}),new a.RegistrationDateDeviceGridColumn({visible:!1}),new a.SystemIdDeviceGridColumn({visible:!1}),new a.ImeiDeviceGridColumn({visible:!1}),new a.AlarmsDeviceGridColumn]:this.columns=this.searchService.getDefaultColumns(),this.serverSideDataCallback=this.onDataSourceModifier.bind(this),this.setActionControls()},e.prototype.trackByName=function(e,t){return t.name},e.prototype.onDataSourceModifier=function(e){return f(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return e.searchText?[4,this.searchService.search(e.searchText)]:[3,2];case 1:return t=o.sent(),[3,4];case 2:return[4,this.searchService.getData(e.columns,e.pagination,void 0)];case 3:t=o.sent(),o.label=4;case 4:return n=t.res,r=t.data,i=t.paging,s=this.searchService.filterOnlyAssets(r),1===i.currentPage&&(this.sizeCount=0),this.sizeCount+=s.length,this.onColumnsChange.emit(e.columns),[2,{res:n,data:s,paging:i,filteredSize:this.sizeCount,size:void 0}]}}))}))},e.prototype.setActionControls=function(){var e=this,t=[],n={type:"DELETE",callback:function(t){return e.onDeleteAsset(t,e.parentGroup)}};t.push(n),this.actionControls||(this.actionControls=t)},e.prototype.updateFiltering=function(e,t){t.type===o.FilteringActionType.ResetFilter?this.dataGrid.clearFilters():this.dataGrid.updateFiltering(e,t)},e.prototype.configChange=function(e){this.searchService.saveConfig(e)},e.prototype.onDeleteAsset=function(e,t){var r=this,i={showWithDeviceUserCheckbox:this.subAssetsGridService.shouldShowWithDeviceUserCheckbox(e),asset:e,showWithCascadeCheckbox:!this.smartGroupsService.isSmartGroup(e)&&!this.smartGroupsService.isSmartGroupV2(e)};this.bsModalService.show(n.DeleteAssetsModalComponent,{initialState:i}).content.closeSubject.subscribe((function(n){return f(r,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return n?[4,this.subAssetsGridService.deleteAsset(e,t,n)]:[3,2];case 1:r.sent(),this.refresh.emit(),r.label=2;case 2:return[2]}}))}))}))},e.ctorParameters=function(){return[{type:g},{type:p.BsModalService},{type:s.SmartGroupsService},{type:n.SubAssetsService}]},y([t.Input("parent-group")],e.prototype,"parentGroup",void 0),y([t.Input()],e.prototype,"title",void 0),y([t.Input()],e.prototype,"loadingItemsLabel",void 0),y([t.Input("columns")],e.prototype,"_columns",null),y([t.Input("pagination")],e.prototype,"_pagination",null),y([t.Input("actionControls")],e.prototype,"_actionControls",null),y([t.Input()],e.prototype,"selectable",void 0),y([t.Input("bulkActionControls")],e.prototype,"_bulkActionControls",null),y([t.Output()],e.prototype,"onColumnsChange",void 0),y([t.Input()],e.prototype,"searchText",void 0),y([t.Input()],e.prototype,"filteringName",void 0),y([t.ViewChild(o.DataGridComponent,{static:!0})],e.prototype,"dataGrid",void 0),e=y([t.Component({selector:"c8y-search-grid",template:'<div class="card--grid--fullpage">\n  <c8y-data-grid\n    [title]="\'Search results\' | translate"\n    [loadingItemsLabel]="loadingItemsLabel"\n    [columns]="columns"\n    [pagination]="pagination"\n    [actionControls]="actionControls"\n    [selectable]="selectable"\n    [bulkActionControls]="bulkActionControls"\n    [serverSideDataCallback]="serverSideDataCallback"\n    [infiniteScroll]="\'auto\'"\n    [showSearch]="true"\n    [searchText]="searchText"\n    [refresh]="refresh"\n    (onConfigChange)="configChange($event)"\n    class="d-contents"\n  >\n    <ng-container *ngFor="let column of columns; trackBy: trackByName">\n      <c8y-column [name]="column.name"></c8y-column>\n    </ng-container>\n    <div class="c8y-empty-state">\n      <h1 c8yIcon="search"></h1>\n      <div>\n        <p>\n          <strong>{{ \'No items found.\' | translate }}</strong>\n        </p>\n        <small>{{ \'Change your search or filter criteria.\' | translate }}</small>\n      </div>\n    </div>\n  </c8y-data-grid>\n</div>\n'})],e)}(),_=function(){function e(e,t){this.route=e,this.alert=t,this.filter="",this.searchTerm="",this.unsubscribe$=new c.Subject}return e.prototype.ngOnInit=function(){var e=this;this.route.queryParams.subscribe((function(t){t.filter&&(e.filteringName=t.filter)}))},e.prototype.ngAfterViewInit=function(){var e=this;this.route.queryParams.pipe(l.takeUntil(this.unsubscribe$)).subscribe((function(t){var n=t.filter,r=t.search;return e.onQueryParamsChange(n,r)})),this.searchGrid.dataGrid.searchText$.pipe(l.takeUntil(this.unsubscribe$)).subscribe((function(t){t&&e.resetFilter(),e.searchTerm=t})),this.searchGrid.dataGrid.onFilter.pipe(l.takeUntil(this.unsubscribe$)).subscribe((function(){return e.resetSearch()})),this.searchTerm=this.route.snapshot.queryParams.search||""},e.prototype.resetSearch=function(){this.searchTerm="",this.searchTerm&&this.alert.add({text:o.gettext("Search reset. Full text search does not support filtering."),type:o.Status.WARNING,timeout:5e3})},e.prototype.resetFilter=function(){this.filter="",this.searchGrid.dataGrid.filteringApplied&&(this.alert.add({text:o.gettext("Filter reset. Full text search does not support filtering."),type:o.Status.WARNING,timeout:5e3}),this.searchGrid.dataGrid.clearFilters())},e.prototype.ngOnDestroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete()},e.prototype.onQueryParamsChange=function(e,t){(!this.shouldFilter(e)&&t||this.shouldFilter(e)&&t)&&this.search(t)},e.prototype.shouldFilter=function(e){return!!e&&(this.resetSearch(),this.filter=e||"",this.searchGrid.updateFiltering(["name"],{type:o.FilteringActionType.ApplyFilter,payload:{filteringModifier:{externalFilterQuery:{names:[this.filter]}}}}),!0)},e.prototype.search=function(e){this.searchTerm=e||"",this.searchGrid.dataGrid.searchText$.next(this.searchTerm)},e.ctorParameters=function(){return[{type:i.ActivatedRoute},{type:o.AlertService}]},y([t.ViewChild(b,{static:!0})],e.prototype,"searchGrid",void 0),e=y([t.Component({selector:"c8y-search-results",template:'<c8y-title>\n  <span translate class="p-r-4">Search</span>\n  <small\n    ngNonBindable\n    translate\n    *ngIf="searchTerm"\n    [translateParams]="{\n      searchHint: searchTerm\n    }"\n    >searching "{{ searchHint }}"</small\n  >\n  <small\n    ngNonBindable\n    translate\n    *ngIf="filter"\n    [translateParams]="{\n      filterHint: filter\n    }"\n    >filtered by "{{ filterHint }}"</small\n  >\n</c8y-title>\n\n<c8y-search-grid [searchText]="searchTerm" [filteringName]="filteringName"></c8y-search-grid>\n'})],e)}(),S=[{path:"assetsearch",component:_}],C=[{template:v}],E=function(){function e(){}return e=y([t.NgModule({declarations:[_,v,b],imports:[o.CoreModule,a.DeviceGridModule,u.BsDropdownModule],entryComponents:[_,v],exports:[_,v,b],providers:[g,{provide:o.HOOK_ONCE_ROUTE,useValue:S,multi:!0},{provide:o.HOOK_SEARCH,useValue:C,multi:!0}]})],e)}();e.SearchBoxComponent=v,e.SearchGridComponent=b,e.SearchModule=E,e.SearchResultsComponent=_,e.SearchService=g,e.ɵ0=S,e.ɵ1=C,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-search.umd.min.js.map