import * as tslib_1 from "tslib";
import { NgModule } from '@angular/core';
import { gettext, ProviderConfigurationModule } from '@c8y/ngx-components';
import { get } from 'lodash-es';
import { SimGuard } from './sim.guard';
export function encodeFiles(model, fields) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const result = Object.assign({}, model);
        const fileFields = (get(fields, '[0].fieldGroup') || []).filter((field) => {
            return field.type === 'file' && field.templateOptions.contentEncoding === 'base64';
        });
        for (const fileField of fileFields) {
            const files = model[fileField.key];
            if (files && files.length) {
                if (fileField.templateOptions.maxAllowedFiles === 1) {
                    result[fileField.key] = (yield files[0].readAsDataURL()).replace(/data:\S+;base64,/gi, '');
                }
                else {
                    const encodedFileContent = [];
                    for (const file of files) {
                        encodedFileContent.push((yield file.readAsDataURL()).replace(/data:\w+\/\w+;base64,/gi, ''));
                    }
                    result[fileField.key] = encodedFileContent;
                }
            }
        }
        return result;
    });
}
let SimModule = class SimModule {
};
SimModule = tslib_1.__decorate([
    NgModule({
        providers: [SimGuard],
        imports: [
            ProviderConfigurationModule.config([
                {
                    navigation: {
                        label: gettext('Connectivity'),
                        path: 'connectivitySettings',
                        icon: 'plug',
                        parent: gettext('Settings'),
                        priority: 1000,
                        preventDuplicates: true
                    },
                    tab: {
                        path: 'sim_provider_settings',
                        label: 'SIM provider settings',
                        icon: 'mobile',
                        canActivate: [SimGuard]
                    },
                    layout: {
                        pageTitle: gettext('Connectivity'),
                        cardTitle: gettext('Settings'),
                        description: gettext(`In order to see the 'Connectivity' tab in device details, the user needs to have 'Read' permission for 'Connectivity'. To change SIM card status and send text messages, the user needs to have 'Admin' permission for 'Connectivity'.`),
                        providerName: gettext('Provider'),
                        providerNamePlaceholder: gettext('Select or type to filter providers'),
                        providerNameNoMatchesHint: gettext('Select one of the existing providers.'),
                        deleteRoles: ['ROLE_CONNECTIVITY_ADMIN'],
                        deleteBtnLabel: gettext('Delete'),
                        saveRoles: ['ROLE_CONNECTIVITY_ADMIN'],
                        saveBtnLabel: gettext('Save'),
                        beforeSaveHook: encodeFiles,
                        configurationUpdatedSuccessMsg: gettext('Settings updated.'),
                        deleteConfigurationModalTitle: gettext('Delete settings'),
                        deleteConfigurationModalBody: gettext(`You are about to delete SIM provider settings. Do you want to proceed?`),
                        deleteConfigurationModalOkBtnLabel: gettext('Delete'),
                        configurationDeletedSuccessMsg: gettext('Settings deleted.')
                    },
                    endpoint: {
                        definitionsEndpoint: {
                            baseUrl: 'service/connectivity/metadata',
                            listUrl: 'definitions'
                        },
                        configurationEndpoint: {
                            baseUrl: 'service/connectivity/metadata',
                            listUrl: 'sim/provider'
                        }
                    }
                }
            ])
        ]
    })
], SimModule);
export { SimModule };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltLm1vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvY29ubmVjdGl2aXR5LyIsInNvdXJjZXMiOlsic2ltL3NpbS5tb2R1bGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekMsT0FBTyxFQUVMLE9BQU8sRUFDUCwyQkFBMkIsRUFFNUIsTUFBTSxxQkFBcUIsQ0FBQztBQUU3QixPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2hDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFdkMsTUFBTSxVQUFnQixXQUFXLENBQy9CLEtBQXlCLEVBQ3pCLE1BQTJCOztRQUUzQixNQUFNLE1BQU0scUJBQTRCLEtBQUssQ0FBRSxDQUFDO1FBQ2hELE1BQU0sVUFBVSxHQUF3QixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQ2xGLENBQUMsS0FBd0IsRUFBRSxFQUFFO1lBQzNCLE9BQU8sS0FBSyxDQUFDLElBQUksS0FBSyxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxlQUFlLEtBQUssUUFBUSxDQUFDO1FBQ3JGLENBQUMsQ0FDRixDQUFDO1FBRUYsS0FBSyxNQUFNLFNBQVMsSUFBSSxVQUFVLEVBQUU7WUFDbEMsTUFBTSxLQUFLLEdBQWtCLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBYSxDQUFDLENBQUM7WUFDNUQsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtnQkFDekIsSUFBSSxTQUFTLENBQUMsZUFBZSxDQUFDLGVBQWUsS0FBSyxDQUFDLEVBQUU7b0JBQ25ELE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBYSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FDeEUsb0JBQW9CLEVBQ3BCLEVBQUUsQ0FDSCxDQUFDO2lCQUNIO3FCQUFNO29CQUNMLE1BQU0sa0JBQWtCLEdBQWEsRUFBRSxDQUFDO29CQUV4QyxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRTt3QkFDeEIsa0JBQWtCLENBQUMsSUFBSSxDQUNyQixDQUFDLE1BQU0sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLHlCQUF5QixFQUFFLEVBQUUsQ0FBQyxDQUNwRSxDQUFDO3FCQUNIO29CQUVELE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBYSxDQUFDLEdBQUcsa0JBQWtCLENBQUM7aUJBQ3REO2FBQ0Y7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Q0FBQTtBQXlERCxJQUFhLFNBQVMsR0FBdEIsTUFBYSxTQUFTO0NBQUcsQ0FBQTtBQUFaLFNBQVM7SUF2RHJCLFFBQVEsQ0FBQztRQUNSLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQztRQUNyQixPQUFPLEVBQUU7WUFDUCwyQkFBMkIsQ0FBQyxNQUFNLENBQUM7Z0JBQ2pDO29CQUNFLFVBQVUsRUFBRTt3QkFDVixLQUFLLEVBQUUsT0FBTyxDQUFDLGNBQWMsQ0FBQzt3QkFDOUIsSUFBSSxFQUFFLHNCQUFzQjt3QkFDNUIsSUFBSSxFQUFFLE1BQU07d0JBQ1osTUFBTSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUM7d0JBQzNCLFFBQVEsRUFBRSxJQUFJO3dCQUNkLGlCQUFpQixFQUFFLElBQUk7cUJBQ3hCO29CQUNELEdBQUcsRUFBRTt3QkFDSCxJQUFJLEVBQUUsdUJBQXVCO3dCQUM3QixLQUFLLEVBQUUsdUJBQXVCO3dCQUM5QixJQUFJLEVBQUUsUUFBUTt3QkFDZCxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7cUJBQ3hCO29CQUNELE1BQU0sRUFBRTt3QkFDTixTQUFTLEVBQUUsT0FBTyxDQUFDLGNBQWMsQ0FBQzt3QkFDbEMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUM7d0JBQzlCLFdBQVcsRUFBRSxPQUFPLENBQ2xCLHdPQUF3TyxDQUN6Tzt3QkFDRCxZQUFZLEVBQUUsT0FBTyxDQUFDLFVBQVUsQ0FBQzt3QkFDakMsdUJBQXVCLEVBQUUsT0FBTyxDQUFDLG9DQUFvQyxDQUFDO3dCQUN0RSx5QkFBeUIsRUFBRSxPQUFPLENBQUMsdUNBQXVDLENBQUM7d0JBQzNFLFdBQVcsRUFBRSxDQUFDLHlCQUF5QixDQUFDO3dCQUN4QyxjQUFjLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQzt3QkFDakMsU0FBUyxFQUFFLENBQUMseUJBQXlCLENBQUM7d0JBQ3RDLFlBQVksRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDO3dCQUM3QixjQUFjLEVBQUUsV0FBVzt3QkFDM0IsOEJBQThCLEVBQUUsT0FBTyxDQUFDLG1CQUFtQixDQUFDO3dCQUM1RCw2QkFBNkIsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUM7d0JBQ3pELDRCQUE0QixFQUFFLE9BQU8sQ0FDbkMsd0VBQXdFLENBQ3pFO3dCQUNELGtDQUFrQyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUM7d0JBQ3JELDhCQUE4QixFQUFFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztxQkFDN0Q7b0JBQ0QsUUFBUSxFQUFFO3dCQUNSLG1CQUFtQixFQUFFOzRCQUNuQixPQUFPLEVBQUUsK0JBQStCOzRCQUN4QyxPQUFPLEVBQUUsYUFBYTt5QkFDdkI7d0JBQ0QscUJBQXFCLEVBQUU7NEJBQ3JCLE9BQU8sRUFBRSwrQkFBK0I7NEJBQ3hDLE9BQU8sRUFBRSxjQUFjO3lCQUN4QjtxQkFDRjtpQkFDRjthQUNGLENBQUM7U0FDSDtLQUNGLENBQUM7R0FDVyxTQUFTLENBQUc7U0FBWixTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIERyb3BwZWRGaWxlLFxuICBnZXR0ZXh0LFxuICBQcm92aWRlckNvbmZpZ3VyYXRpb25Nb2R1bGUsXG4gIFByb3ZpZGVyUHJvcGVydGllc1xufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgU2ltR3VhcmQgfSBmcm9tICcuL3NpbS5ndWFyZCc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmNvZGVGaWxlcyhcbiAgbW9kZWw6IFByb3ZpZGVyUHJvcGVydGllcyxcbiAgZmllbGRzOiBGb3JtbHlGaWVsZENvbmZpZ1tdXG4pOiBQcm9taXNlPFByb3ZpZGVyUHJvcGVydGllcz4ge1xuICBjb25zdCByZXN1bHQ6IFByb3ZpZGVyUHJvcGVydGllcyA9IHsgLi4ubW9kZWwgfTtcbiAgY29uc3QgZmlsZUZpZWxkczogRm9ybWx5RmllbGRDb25maWdbXSA9IChnZXQoZmllbGRzLCAnWzBdLmZpZWxkR3JvdXAnKSB8fCBbXSkuZmlsdGVyKFxuICAgIChmaWVsZDogRm9ybWx5RmllbGRDb25maWcpID0+IHtcbiAgICAgIHJldHVybiBmaWVsZC50eXBlID09PSAnZmlsZScgJiYgZmllbGQudGVtcGxhdGVPcHRpb25zLmNvbnRlbnRFbmNvZGluZyA9PT0gJ2Jhc2U2NCc7XG4gICAgfVxuICApO1xuXG4gIGZvciAoY29uc3QgZmlsZUZpZWxkIG9mIGZpbGVGaWVsZHMpIHtcbiAgICBjb25zdCBmaWxlczogRHJvcHBlZEZpbGVbXSA9IG1vZGVsW2ZpbGVGaWVsZC5rZXkgYXMgc3RyaW5nXTtcbiAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoKSB7XG4gICAgICBpZiAoZmlsZUZpZWxkLnRlbXBsYXRlT3B0aW9ucy5tYXhBbGxvd2VkRmlsZXMgPT09IDEpIHtcbiAgICAgICAgcmVzdWx0W2ZpbGVGaWVsZC5rZXkgYXMgc3RyaW5nXSA9IChhd2FpdCBmaWxlc1swXS5yZWFkQXNEYXRhVVJMKCkpLnJlcGxhY2UoXG4gICAgICAgICAgL2RhdGE6XFxTKztiYXNlNjQsL2dpLFxuICAgICAgICAgICcnXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbmNvZGVkRmlsZUNvbnRlbnQ6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgZW5jb2RlZEZpbGVDb250ZW50LnB1c2goXG4gICAgICAgICAgICAoYXdhaXQgZmlsZS5yZWFkQXNEYXRhVVJMKCkpLnJlcGxhY2UoL2RhdGE6XFx3K1xcL1xcdys7YmFzZTY0LC9naSwgJycpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3VsdFtmaWxlRmllbGQua2V5IGFzIHN0cmluZ10gPSBlbmNvZGVkRmlsZUNvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbkBOZ01vZHVsZSh7XG4gIHByb3ZpZGVyczogW1NpbUd1YXJkXSxcbiAgaW1wb3J0czogW1xuICAgIFByb3ZpZGVyQ29uZmlndXJhdGlvbk1vZHVsZS5jb25maWcoW1xuICAgICAge1xuICAgICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgICAgbGFiZWw6IGdldHRleHQoJ0Nvbm5lY3Rpdml0eScpLFxuICAgICAgICAgIHBhdGg6ICdjb25uZWN0aXZpdHlTZXR0aW5ncycsXG4gICAgICAgICAgaWNvbjogJ3BsdWcnLFxuICAgICAgICAgIHBhcmVudDogZ2V0dGV4dCgnU2V0dGluZ3MnKSxcbiAgICAgICAgICBwcmlvcml0eTogMTAwMCxcbiAgICAgICAgICBwcmV2ZW50RHVwbGljYXRlczogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB0YWI6IHtcbiAgICAgICAgICBwYXRoOiAnc2ltX3Byb3ZpZGVyX3NldHRpbmdzJyxcbiAgICAgICAgICBsYWJlbDogJ1NJTSBwcm92aWRlciBzZXR0aW5ncycsXG4gICAgICAgICAgaWNvbjogJ21vYmlsZScsXG4gICAgICAgICAgY2FuQWN0aXZhdGU6IFtTaW1HdWFyZF1cbiAgICAgICAgfSxcbiAgICAgICAgbGF5b3V0OiB7XG4gICAgICAgICAgcGFnZVRpdGxlOiBnZXR0ZXh0KCdDb25uZWN0aXZpdHknKSxcbiAgICAgICAgICBjYXJkVGl0bGU6IGdldHRleHQoJ1NldHRpbmdzJyksXG4gICAgICAgICAgZGVzY3JpcHRpb246IGdldHRleHQoXG4gICAgICAgICAgICBgSW4gb3JkZXIgdG8gc2VlIHRoZSAnQ29ubmVjdGl2aXR5JyB0YWIgaW4gZGV2aWNlIGRldGFpbHMsIHRoZSB1c2VyIG5lZWRzIHRvIGhhdmUgJ1JlYWQnIHBlcm1pc3Npb24gZm9yICdDb25uZWN0aXZpdHknLiBUbyBjaGFuZ2UgU0lNIGNhcmQgc3RhdHVzIGFuZCBzZW5kIHRleHQgbWVzc2FnZXMsIHRoZSB1c2VyIG5lZWRzIHRvIGhhdmUgJ0FkbWluJyBwZXJtaXNzaW9uIGZvciAnQ29ubmVjdGl2aXR5Jy5gXG4gICAgICAgICAgKSxcbiAgICAgICAgICBwcm92aWRlck5hbWU6IGdldHRleHQoJ1Byb3ZpZGVyJyksXG4gICAgICAgICAgcHJvdmlkZXJOYW1lUGxhY2Vob2xkZXI6IGdldHRleHQoJ1NlbGVjdCBvciB0eXBlIHRvIGZpbHRlciBwcm92aWRlcnMnKSxcbiAgICAgICAgICBwcm92aWRlck5hbWVOb01hdGNoZXNIaW50OiBnZXR0ZXh0KCdTZWxlY3Qgb25lIG9mIHRoZSBleGlzdGluZyBwcm92aWRlcnMuJyksXG4gICAgICAgICAgZGVsZXRlUm9sZXM6IFsnUk9MRV9DT05ORUNUSVZJVFlfQURNSU4nXSxcbiAgICAgICAgICBkZWxldGVCdG5MYWJlbDogZ2V0dGV4dCgnRGVsZXRlJyksXG4gICAgICAgICAgc2F2ZVJvbGVzOiBbJ1JPTEVfQ09OTkVDVElWSVRZX0FETUlOJ10sXG4gICAgICAgICAgc2F2ZUJ0bkxhYmVsOiBnZXR0ZXh0KCdTYXZlJyksXG4gICAgICAgICAgYmVmb3JlU2F2ZUhvb2s6IGVuY29kZUZpbGVzLFxuICAgICAgICAgIGNvbmZpZ3VyYXRpb25VcGRhdGVkU3VjY2Vzc01zZzogZ2V0dGV4dCgnU2V0dGluZ3MgdXBkYXRlZC4nKSxcbiAgICAgICAgICBkZWxldGVDb25maWd1cmF0aW9uTW9kYWxUaXRsZTogZ2V0dGV4dCgnRGVsZXRlIHNldHRpbmdzJyksXG4gICAgICAgICAgZGVsZXRlQ29uZmlndXJhdGlvbk1vZGFsQm9keTogZ2V0dGV4dChcbiAgICAgICAgICAgIGBZb3UgYXJlIGFib3V0IHRvIGRlbGV0ZSBTSU0gcHJvdmlkZXIgc2V0dGluZ3MuIERvIHlvdSB3YW50IHRvIHByb2NlZWQ/YFxuICAgICAgICAgICksXG4gICAgICAgICAgZGVsZXRlQ29uZmlndXJhdGlvbk1vZGFsT2tCdG5MYWJlbDogZ2V0dGV4dCgnRGVsZXRlJyksXG4gICAgICAgICAgY29uZmlndXJhdGlvbkRlbGV0ZWRTdWNjZXNzTXNnOiBnZXR0ZXh0KCdTZXR0aW5ncyBkZWxldGVkLicpXG4gICAgICAgIH0sXG4gICAgICAgIGVuZHBvaW50OiB7XG4gICAgICAgICAgZGVmaW5pdGlvbnNFbmRwb2ludDoge1xuICAgICAgICAgICAgYmFzZVVybDogJ3NlcnZpY2UvY29ubmVjdGl2aXR5L21ldGFkYXRhJyxcbiAgICAgICAgICAgIGxpc3RVcmw6ICdkZWZpbml0aW9ucydcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbmZpZ3VyYXRpb25FbmRwb2ludDoge1xuICAgICAgICAgICAgYmFzZVVybDogJ3NlcnZpY2UvY29ubmVjdGl2aXR5L21ldGFkYXRhJyxcbiAgICAgICAgICAgIGxpc3RVcmw6ICdzaW0vcHJvdmlkZXInXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXSlcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBTaW1Nb2R1bGUge31cbiJdfQ==