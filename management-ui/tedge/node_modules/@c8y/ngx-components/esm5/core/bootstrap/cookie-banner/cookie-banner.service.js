import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { OptionsService } from '../../common/options.service';
import { gettext } from '../../i18n/gettext';
import * as i0 from "@angular/core";
import * as i1 from "../../common/options.service";
/**
 * This service is handling the cookie banner and cookie preferences related logic.
 */
var CookieBannerService = /** @class */ (function () {
    function CookieBannerService(options) {
        this.options = options;
        this.STORAGE_KEY = 'acceptCookieNotice';
        this.COOKIE_BANNER = 'cookieBanner';
        this.COOKIE_PREFERENCES_CONFIG = 'cookiePreferences';
        this.isCookieBannerShowed$ = new Subject();
        this.cookieDescriptions = {
            required: gettext("These cookies are required to enable core site functionality. They perform a task or operation without which a site's functionality would not be possible."),
            functional: gettext('These cookies are used to track site usage and to process my personal data to measure and improve usability and performance. We will neither forward this data to any third party nor use this data for direct marketing purposes. I recognize that I can opt in and out of these cookies at any time.'),
            marketing: gettext('These cookies are used to target advertising to a user.')
        };
    }
    /**
     * Returns Cookie preferences configuration.
     * @returns {object} Return an object with cookie preferences configuration defined in application options.
     */
    CookieBannerService.prototype.getCookiePreferencesConfig = function () {
        return this.options.get(this.COOKIE_PREFERENCES_CONFIG);
    };
    /**
     * Returns Cookie banner configuration.
     * @returns {object} Return an object with cookie banner configuration defined in application options.
     */
    CookieBannerService.prototype.getCookieBannerSettings = function () {
        return this.options.get(this.COOKIE_BANNER) || {};
    };
    /**
     * Converts the cookie preferences to boolean. Sets the cookie preferences configuration in local storage.
     * @param {object} cookiePreferences Object with cookie preferences configuration
     */
    CookieBannerService.prototype.setCookies = function (cookiePreferences) {
        var cookiesToSet = tslib_1.__assign({}, cookiePreferences);
        Object.entries(cookiesToSet).forEach(function (_a) {
            var _b = tslib_1.__read(_a, 2), cookieName = _b[0], cookieValue = _b[1];
            cookiesToSet[cookieName] = typeof cookieValue === 'string' ? true : cookieValue;
        });
        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(cookiesToSet));
    };
    /**
     * Verifies that cookie banner should be shown.
     * @returns {boolean} Returns if the cookie banner should be shown.
     */
    CookieBannerService.prototype.shouldShowCookieBanner = function () {
        var settings = this.getCookieBannerSettings();
        return !!settings.cookieBannerText && !this.getUserCookiePreferences();
    };
    /**
     * Gets the cookie preferences configuration from local storage.
     * @returns {object} Object with cookie preferences configuration.
     */
    CookieBannerService.prototype.getUserCookiePreferences = function () {
        return JSON.parse(localStorage.getItem(this.STORAGE_KEY));
    };
    /**
     * Verifies that cookie preferences configuration is defined.
     * @returns {boolean} Returns if the cookie preferences configuration is defined.
     */
    CookieBannerService.prototype.isConfigCookiePreferencesDefined = function () {
        return !!this.getCookiePreferencesConfig();
    };
    /**
     * Verifies that functional cookies are enabled.
     * @returns {boolean} True when functional cookies are enabled.
     */
    CookieBannerService.prototype.isFunctionalCookieEnabled = function () {
        var functional = (this.getUserCookiePreferences() || {}).functional;
        return functional === true;
    };
    /**
     * Description of cookies.
     * @param {'required' | 'functional' | 'marketing'} cookieType Takes one of the following options: 'required', 'functional', 'marketing'.
     * @returns {string} The default cookie description, if not explicitly defined in application options.
     */
    CookieBannerService.prototype.getCookieDescription = function (cookieType) {
        var cookieBannerConfigSettings = this.getCookiePreferencesConfig();
        return typeof cookieBannerConfigSettings[cookieType] === 'string'
            ? cookieBannerConfigSettings[cookieType]
            : this.cookieDescriptions[cookieType];
    };
    /**
     * Transforms cookie preferences configuration object to an array of cookie preferences objects. Each object in returned array contains cookie 'name', 'value' and 'isReadonly' property.
     * @param {object} cookiePreferences.
     * @returns {Array} Array shows if the cookie is Readonly.
     */
    CookieBannerService.prototype.transformCookiePreferencesToList = function (cookiePreferences) {
        return Object.entries(cookiePreferences).map(function (_a) {
            var _b = tslib_1.__read(_a, 2), name = _b[0], value = _b[1];
            var isReadonly = name === 'required';
            return { name: name, value: value, isReadonly: isReadonly };
        });
    };
    /**
     * Transforms an array of cookie preferences objects to cookie preferences configuration object.
     * @param {Array} cookiePreferencesList Array of cookie preferences.
     * @returns {object} An object with cookie preferences configuration.
     */
    CookieBannerService.prototype.transformCookiePreferencesListToCookiePreferences = function (cookiePreferencesList) {
        return cookiePreferencesList.reduce(function (cookiePref, cookie) {
            var key = cookie.name;
            cookiePref[key] = cookie.value;
            return cookiePref;
        }, {});
    };
    CookieBannerService.ctorParameters = function () { return [
        { type: OptionsService }
    ]; };
    CookieBannerService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function CookieBannerService_Factory() { return new CookieBannerService(i0.ɵɵinject(i1.OptionsService)); }, token: CookieBannerService, providedIn: "root" });
    CookieBannerService = tslib_1.__decorate([
        Injectable({
            providedIn: 'root'
        })
    ], CookieBannerService);
    return CookieBannerService;
}());
export { CookieBannerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLWJhbm5lci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvcmUvYm9vdHN0cmFwL2Nvb2tpZS1iYW5uZXIvY29va2llLWJhbm5lci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzlELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7O0FBRzdDOztHQUVHO0FBSUg7SUFnQkUsNkJBQW9CLE9BQXVCO1FBQXZCLFlBQU8sR0FBUCxPQUFPLENBQWdCO1FBZmxDLGdCQUFXLEdBQVcsb0JBQW9CLENBQUM7UUFDM0Msa0JBQWEsR0FBRyxjQUFjLENBQUM7UUFDL0IsOEJBQXlCLEdBQUcsbUJBQW1CLENBQUM7UUFDekQsMEJBQXFCLEdBQXFCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFeEQsdUJBQWtCLEdBQUc7WUFDbkIsUUFBUSxFQUFFLE9BQU8sQ0FDZiw0SkFBNEosQ0FDN0o7WUFDRCxVQUFVLEVBQUUsT0FBTyxDQUNqQix3U0FBd1MsQ0FDelM7WUFDRCxTQUFTLEVBQUUsT0FBTyxDQUFDLHlEQUF5RCxDQUFDO1NBQzlFLENBQUM7SUFFNEMsQ0FBQztJQUUvQzs7O09BR0c7SUFDSCx3REFBMEIsR0FBMUI7UUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFRDs7O09BR0c7SUFDSCxxREFBdUIsR0FBdkI7UUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDcEQsQ0FBQztJQUVEOzs7T0FHRztJQUNILHdDQUFVLEdBQVYsVUFBVyxpQkFBb0M7UUFDN0MsSUFBTSxZQUFZLHdCQUFRLGlCQUFpQixDQUFFLENBQUM7UUFDOUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUF5QjtnQkFBekIsMEJBQXlCLEVBQXhCLGtCQUFVLEVBQUUsbUJBQVc7WUFDNUQsWUFBWSxDQUFDLFVBQVUsQ0FBQyxHQUFHLE9BQU8sV0FBVyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7UUFDbEYsQ0FBQyxDQUFDLENBQUM7UUFDSCxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFFRDs7O09BR0c7SUFDSCxvREFBc0IsR0FBdEI7UUFDRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUNoRCxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUN6RSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsc0RBQXdCLEdBQXhCO1FBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVEOzs7T0FHRztJQUNILDhEQUFnQyxHQUFoQztRQUNFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRDs7O09BR0c7SUFDSCx1REFBeUIsR0FBekI7UUFDVSxJQUFBLCtEQUFVLENBQThEO1FBQ2hGLE9BQU8sVUFBVSxLQUFLLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGtEQUFvQixHQUFwQixVQUFxQixVQUFtRDtRQUN0RSxJQUFNLDBCQUEwQixHQUFHLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1FBQ3JFLE9BQU8sT0FBTywwQkFBMEIsQ0FBQyxVQUFVLENBQUMsS0FBSyxRQUFRO1lBQy9ELENBQUMsQ0FBQywwQkFBMEIsQ0FBQyxVQUFVLENBQUM7WUFDeEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDhEQUFnQyxHQUFoQyxVQUFpQyxpQkFBb0M7UUFDbkUsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsRUFBYTtnQkFBYiwwQkFBYSxFQUFaLFlBQUksRUFBRSxhQUFLO1lBQ3hELElBQU0sVUFBVSxHQUFHLElBQUksS0FBSyxVQUFVLENBQUM7WUFDdkMsT0FBTyxFQUFFLElBQUksTUFBQSxFQUFFLEtBQUssT0FBQSxFQUFFLFVBQVUsWUFBQSxFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILCtFQUFpRCxHQUFqRCxVQUNFLHFCQUErQjtRQUUvQixPQUFPLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxVQUFDLFVBQTZCLEVBQUUsTUFBYztZQUNoRixJQUFNLEdBQUcsR0FBVyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2hDLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQy9CLE9BQU8sVUFBVSxDQUFDO1FBQ3BCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUM7O2dCQXJHNEIsY0FBYzs7O0lBaEJoQyxtQkFBbUI7UUFIL0IsVUFBVSxDQUFDO1lBQ1YsVUFBVSxFQUFFLE1BQU07U0FDbkIsQ0FBQztPQUNXLG1CQUFtQixDQXNIL0I7OEJBbElEO0NBa0lDLEFBdEhELElBc0hDO1NBdEhZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE9wdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29tbW9uL29wdGlvbnMuc2VydmljZSc7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnLi4vLi4vaTE4bi9nZXR0ZXh0JztcbmltcG9ydCB7IENvb2tpZSwgQ29va2llQmFubmVyU2V0dGluZ3MsIENvb2tpZVByZWZlcmVuY2VzIH0gZnJvbSAnLi9jb29raWUtYmFubmVyLm1vZGVsJztcblxuLyoqXG4gKiBUaGlzIHNlcnZpY2UgaXMgaGFuZGxpbmcgdGhlIGNvb2tpZSBiYW5uZXIgYW5kIGNvb2tpZSBwcmVmZXJlbmNlcyByZWxhdGVkIGxvZ2ljLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBDb29raWVCYW5uZXJTZXJ2aWNlIHtcbiAgcmVhZG9ubHkgU1RPUkFHRV9LRVk6IHN0cmluZyA9ICdhY2NlcHRDb29raWVOb3RpY2UnO1xuICByZWFkb25seSBDT09LSUVfQkFOTkVSID0gJ2Nvb2tpZUJhbm5lcic7XG4gIHJlYWRvbmx5IENPT0tJRV9QUkVGRVJFTkNFU19DT05GSUcgPSAnY29va2llUHJlZmVyZW5jZXMnO1xuICBpc0Nvb2tpZUJhbm5lclNob3dlZCQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvb2tpZURlc2NyaXB0aW9ucyA9IHtcbiAgICByZXF1aXJlZDogZ2V0dGV4dChcbiAgICAgIFwiVGhlc2UgY29va2llcyBhcmUgcmVxdWlyZWQgdG8gZW5hYmxlIGNvcmUgc2l0ZSBmdW5jdGlvbmFsaXR5LiBUaGV5IHBlcmZvcm0gYSB0YXNrIG9yIG9wZXJhdGlvbiB3aXRob3V0IHdoaWNoIGEgc2l0ZSdzIGZ1bmN0aW9uYWxpdHkgd291bGQgbm90IGJlIHBvc3NpYmxlLlwiXG4gICAgKSxcbiAgICBmdW5jdGlvbmFsOiBnZXR0ZXh0KFxuICAgICAgJ1RoZXNlIGNvb2tpZXMgYXJlIHVzZWQgdG8gdHJhY2sgc2l0ZSB1c2FnZSBhbmQgdG8gcHJvY2VzcyBteSBwZXJzb25hbCBkYXRhIHRvIG1lYXN1cmUgYW5kIGltcHJvdmUgdXNhYmlsaXR5IGFuZCBwZXJmb3JtYW5jZS4gV2Ugd2lsbCBuZWl0aGVyIGZvcndhcmQgdGhpcyBkYXRhIHRvIGFueSB0aGlyZCBwYXJ0eSBub3IgdXNlIHRoaXMgZGF0YSBmb3IgZGlyZWN0IG1hcmtldGluZyBwdXJwb3Nlcy4gSSByZWNvZ25pemUgdGhhdCBJIGNhbiBvcHQgaW4gYW5kIG91dCBvZiB0aGVzZSBjb29raWVzIGF0IGFueSB0aW1lLidcbiAgICApLFxuICAgIG1hcmtldGluZzogZ2V0dGV4dCgnVGhlc2UgY29va2llcyBhcmUgdXNlZCB0byB0YXJnZXQgYWR2ZXJ0aXNpbmcgdG8gYSB1c2VyLicpXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBvcHRpb25zOiBPcHRpb25zU2VydmljZSkge31cblxuICAvKipcbiAgICogUmV0dXJucyBDb29raWUgcHJlZmVyZW5jZXMgY29uZmlndXJhdGlvbi5cbiAgICogQHJldHVybnMge29iamVjdH0gUmV0dXJuIGFuIG9iamVjdCB3aXRoIGNvb2tpZSBwcmVmZXJlbmNlcyBjb25maWd1cmF0aW9uIGRlZmluZWQgaW4gYXBwbGljYXRpb24gb3B0aW9ucy5cbiAgICovXG4gIGdldENvb2tpZVByZWZlcmVuY2VzQ29uZmlnKCk6IENvb2tpZVByZWZlcmVuY2VzIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmdldCh0aGlzLkNPT0tJRV9QUkVGRVJFTkNFU19DT05GSUcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgQ29va2llIGJhbm5lciBjb25maWd1cmF0aW9uLlxuICAgKiBAcmV0dXJucyB7b2JqZWN0fSBSZXR1cm4gYW4gb2JqZWN0IHdpdGggY29va2llIGJhbm5lciBjb25maWd1cmF0aW9uIGRlZmluZWQgaW4gYXBwbGljYXRpb24gb3B0aW9ucy5cbiAgICovXG4gIGdldENvb2tpZUJhbm5lclNldHRpbmdzKCk6IENvb2tpZUJhbm5lclNldHRpbmdzIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmdldCh0aGlzLkNPT0tJRV9CQU5ORVIpIHx8IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIHRoZSBjb29raWUgcHJlZmVyZW5jZXMgdG8gYm9vbGVhbi4gU2V0cyB0aGUgY29va2llIHByZWZlcmVuY2VzIGNvbmZpZ3VyYXRpb24gaW4gbG9jYWwgc3RvcmFnZS5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNvb2tpZVByZWZlcmVuY2VzIE9iamVjdCB3aXRoIGNvb2tpZSBwcmVmZXJlbmNlcyBjb25maWd1cmF0aW9uXG4gICAqL1xuICBzZXRDb29raWVzKGNvb2tpZVByZWZlcmVuY2VzOiBDb29raWVQcmVmZXJlbmNlcykge1xuICAgIGNvbnN0IGNvb2tpZXNUb1NldCA9IHsgLi4uY29va2llUHJlZmVyZW5jZXMgfTtcbiAgICBPYmplY3QuZW50cmllcyhjb29raWVzVG9TZXQpLmZvckVhY2goKFtjb29raWVOYW1lLCBjb29raWVWYWx1ZV0pID0+IHtcbiAgICAgIGNvb2tpZXNUb1NldFtjb29raWVOYW1lXSA9IHR5cGVvZiBjb29raWVWYWx1ZSA9PT0gJ3N0cmluZycgPyB0cnVlIDogY29va2llVmFsdWU7XG4gICAgfSk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5TVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoY29va2llc1RvU2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpZXMgdGhhdCBjb29raWUgYmFubmVyIHNob3VsZCBiZSBzaG93bi5cbiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgaWYgdGhlIGNvb2tpZSBiYW5uZXIgc2hvdWxkIGJlIHNob3duLlxuICAgKi9cbiAgc2hvdWxkU2hvd0Nvb2tpZUJhbm5lcigpOiBib29sZWFuIHtcbiAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuZ2V0Q29va2llQmFubmVyU2V0dGluZ3MoKTtcbiAgICByZXR1cm4gISFzZXR0aW5ncy5jb29raWVCYW5uZXJUZXh0ICYmICF0aGlzLmdldFVzZXJDb29raWVQcmVmZXJlbmNlcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGNvb2tpZSBwcmVmZXJlbmNlcyBjb25maWd1cmF0aW9uIGZyb20gbG9jYWwgc3RvcmFnZS5cbiAgICogQHJldHVybnMge29iamVjdH0gT2JqZWN0IHdpdGggY29va2llIHByZWZlcmVuY2VzIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICBnZXRVc2VyQ29va2llUHJlZmVyZW5jZXMoKTogQ29va2llUHJlZmVyZW5jZXMge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuU1RPUkFHRV9LRVkpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmllcyB0aGF0IGNvb2tpZSBwcmVmZXJlbmNlcyBjb25maWd1cmF0aW9uIGlzIGRlZmluZWQuXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGlmIHRoZSBjb29raWUgcHJlZmVyZW5jZXMgY29uZmlndXJhdGlvbiBpcyBkZWZpbmVkLlxuICAgKi9cbiAgaXNDb25maWdDb29raWVQcmVmZXJlbmNlc0RlZmluZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5nZXRDb29raWVQcmVmZXJlbmNlc0NvbmZpZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWVzIHRoYXQgZnVuY3Rpb25hbCBjb29raWVzIGFyZSBlbmFibGVkLlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSB3aGVuIGZ1bmN0aW9uYWwgY29va2llcyBhcmUgZW5hYmxlZC5cbiAgICovXG4gIGlzRnVuY3Rpb25hbENvb2tpZUVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyBmdW5jdGlvbmFsIH06IENvb2tpZVByZWZlcmVuY2VzID0gdGhpcy5nZXRVc2VyQ29va2llUHJlZmVyZW5jZXMoKSB8fCB7fTtcbiAgICByZXR1cm4gZnVuY3Rpb25hbCA9PT0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNjcmlwdGlvbiBvZiBjb29raWVzLlxuICAgKiBAcGFyYW0geydyZXF1aXJlZCcgfCAnZnVuY3Rpb25hbCcgfCAnbWFya2V0aW5nJ30gY29va2llVHlwZSBUYWtlcyBvbmUgb2YgdGhlIGZvbGxvd2luZyBvcHRpb25zOiAncmVxdWlyZWQnLCAnZnVuY3Rpb25hbCcsICdtYXJrZXRpbmcnLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgZGVmYXVsdCBjb29raWUgZGVzY3JpcHRpb24sIGlmIG5vdCBleHBsaWNpdGx5IGRlZmluZWQgaW4gYXBwbGljYXRpb24gb3B0aW9ucy5cbiAgICovXG4gIGdldENvb2tpZURlc2NyaXB0aW9uKGNvb2tpZVR5cGU6ICdyZXF1aXJlZCcgfCAnZnVuY3Rpb25hbCcgfCAnbWFya2V0aW5nJyk6IHN0cmluZyB7XG4gICAgY29uc3QgY29va2llQmFubmVyQ29uZmlnU2V0dGluZ3MgPSB0aGlzLmdldENvb2tpZVByZWZlcmVuY2VzQ29uZmlnKCk7XG4gICAgcmV0dXJuIHR5cGVvZiBjb29raWVCYW5uZXJDb25maWdTZXR0aW5nc1tjb29raWVUeXBlXSA9PT0gJ3N0cmluZydcbiAgICAgID8gY29va2llQmFubmVyQ29uZmlnU2V0dGluZ3NbY29va2llVHlwZV1cbiAgICAgIDogdGhpcy5jb29raWVEZXNjcmlwdGlvbnNbY29va2llVHlwZV07XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNmb3JtcyBjb29raWUgcHJlZmVyZW5jZXMgY29uZmlndXJhdGlvbiBvYmplY3QgdG8gYW4gYXJyYXkgb2YgY29va2llIHByZWZlcmVuY2VzIG9iamVjdHMuIEVhY2ggb2JqZWN0IGluIHJldHVybmVkIGFycmF5IGNvbnRhaW5zIGNvb2tpZSAnbmFtZScsICd2YWx1ZScgYW5kICdpc1JlYWRvbmx5JyBwcm9wZXJ0eS5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNvb2tpZVByZWZlcmVuY2VzLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IHNob3dzIGlmIHRoZSBjb29raWUgaXMgUmVhZG9ubHkuXG4gICAqL1xuICB0cmFuc2Zvcm1Db29raWVQcmVmZXJlbmNlc1RvTGlzdChjb29raWVQcmVmZXJlbmNlczogQ29va2llUHJlZmVyZW5jZXMpOiBDb29raWVbXSB7XG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGNvb2tpZVByZWZlcmVuY2VzKS5tYXAoKFtuYW1lLCB2YWx1ZV0pID0+IHtcbiAgICAgIGNvbnN0IGlzUmVhZG9ubHkgPSBuYW1lID09PSAncmVxdWlyZWQnO1xuICAgICAgcmV0dXJuIHsgbmFtZSwgdmFsdWUsIGlzUmVhZG9ubHkgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2Zvcm1zIGFuIGFycmF5IG9mIGNvb2tpZSBwcmVmZXJlbmNlcyBvYmplY3RzIHRvIGNvb2tpZSBwcmVmZXJlbmNlcyBjb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICogQHBhcmFtIHtBcnJheX0gY29va2llUHJlZmVyZW5jZXNMaXN0IEFycmF5IG9mIGNvb2tpZSBwcmVmZXJlbmNlcy5cbiAgICogQHJldHVybnMge29iamVjdH0gQW4gb2JqZWN0IHdpdGggY29va2llIHByZWZlcmVuY2VzIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICB0cmFuc2Zvcm1Db29raWVQcmVmZXJlbmNlc0xpc3RUb0Nvb2tpZVByZWZlcmVuY2VzKFxuICAgIGNvb2tpZVByZWZlcmVuY2VzTGlzdDogQ29va2llW11cbiAgKTogQ29va2llUHJlZmVyZW5jZXMge1xuICAgIHJldHVybiBjb29raWVQcmVmZXJlbmNlc0xpc3QucmVkdWNlKChjb29raWVQcmVmOiBDb29raWVQcmVmZXJlbmNlcywgY29va2llOiBDb29raWUpID0+IHtcbiAgICAgIGNvbnN0IGtleTogc3RyaW5nID0gY29va2llLm5hbWU7XG4gICAgICBjb29raWVQcmVmW2tleV0gPSBjb29raWUudmFsdWU7XG4gICAgICByZXR1cm4gY29va2llUHJlZjtcbiAgICB9LCB7fSk7XG4gIH1cbn1cbiJdfQ==