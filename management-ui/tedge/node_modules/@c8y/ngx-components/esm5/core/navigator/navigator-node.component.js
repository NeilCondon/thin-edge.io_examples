import * as tslib_1 from "tslib";
// tslint:disable-next-line:max-line-length
import { Component, ComponentFactoryResolver, Input, QueryList, ViewChild, ViewChildren, ViewContainerRef, Output, EventEmitter, OnDestroy } from '@angular/core';
import { RouterLinkActive } from '@angular/router';
import { NavigatorIconComponent } from './navigator-icon.component';
import { NavigatorService } from './navigator.service';
import { PopoverConfirmComponent } from '../modal/popover-confirm.component';
/**
 * Navigator node renderer.
 */
var NavigatorNodeComponent = /** @class */ (function () {
    function NavigatorNodeComponent(componentFactoryResolver, navigator) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.navigator = navigator;
        /**
         * Event emitter responsible for broadcasting one of the following events: "icon", "expander" or "link" as string value.
         *
         * The type of event depends on where you click on the navigator node:
         * * clicking the icon will broadcast the event "icon",
         * * clicking the expander will broadcast the event "expander",
         * * clicking the label will broadcast the event "link".
         */
        this.nodeClick = new EventEmitter();
    }
    NavigatorNodeComponent_1 = NavigatorNodeComponent;
    /**
     * @ignore
     */
    NavigatorNodeComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.childrenNodes.forEach(function (n) { return (n.parentNode = _this); });
        this.viewInitTimeout = setTimeout(function () {
            _this.updateIcon();
            _this.openOnFirstUrl();
            _this.expandParentIfActive();
            _this.node.confirm = _this.confirm;
        });
    };
    /**
     * Expands the navigator node when the URL matches the path provided in the node.
     */
    NavigatorNodeComponent.prototype.openOnFirstUrl = function () {
        if (this.navigator.openOnFirstUrl(this.node) && !this.node.open) {
            this.expandCollapse(true);
        }
    };
    Object.defineProperty(NavigatorNodeComponent.prototype, "expandTitle", {
        /**
         * Returns the expander title.
         */
        get: function () {
            return !this.node.open ? 'Expand' : 'Collapse';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Click event handler.
     *
     * @param {string} from Source of the click event.
     * @param event DOM event.
     */
    NavigatorNodeComponent.prototype.click = function (from, $event) {
        if (from === void 0) { from = 'link'; }
        var open;
        switch (from) {
            case "expander" /* EXPANDER */:
                if ($event) {
                    $event.stopPropagation();
                    $event.preventDefault();
                }
                open = !this.node.open;
                break;
            case "icon" /* ICON */:
            case "link" /* LINK */:
                open = this.routerLinkActive && this.routerLinkActive.isActive ? true : !this.node.open;
                break;
        }
        this.handleExpandCollapse(open, from, $event);
        this.nodeClick.emit(from);
    };
    /**
     * Expands or collapses the navigator node and its children recursively.
     *
     * @param {boolean} open Open or close the node.
     * @param {boolean} recursive Open or close the children.
     * @param {ClickOptions} forNode Click options.
     */
    NavigatorNodeComponent.prototype.expandCollapse = function (open, recursive, forNode) {
        if (forNode === void 0) { forNode = {}; }
        this.node.open = open;
        if (recursive) {
            this.childrenNodes.forEach(function (n) { return n.expandCollapse(open, recursive); });
        }
        forNode.open = open;
        this.node.click(forNode);
    };
    /**
     * @ignore
     */
    NavigatorNodeComponent.prototype.ngOnDestroy = function () {
        clearTimeout(this.viewInitTimeout);
        if (this.node) {
            this.node.destroy();
        }
    };
    NavigatorNodeComponent.prototype.handleExpandCollapse = function (open, from, $event) {
        var _a;
        if (open === this.node.open ||
            (this.node.path && !open && from !== "expander" /* EXPANDER */)) {
            return;
        }
        this.expandCollapse(open, false, (_a = {}, _a[from] = true, _a.$event = $event, _a));
    };
    NavigatorNodeComponent.prototype.expandParentIfActive = function () {
        if (this.routerLinkActive && this.routerLinkActive.isActive && this.parentNode) {
            this.parentNode.expandCollapse(true);
        }
    };
    NavigatorNodeComponent.prototype.updateIcon = function () {
        if (this.node.iconTemplate) {
            this.updateIconTemplate();
        }
        else {
            this.updateIconComponent();
        }
    };
    NavigatorNodeComponent.prototype.updateIconComponent = function () {
        var componentType = NavigatorIconComponent;
        if (this.node && this.node.iconComponent) {
            componentType = this.node.iconComponent;
        }
        this.iconSlot.clear();
        var iconComponentFactory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        var componentRef = this.iconSlot.createComponent(iconComponentFactory);
        componentRef.instance.node = this.node;
    };
    NavigatorNodeComponent.prototype.updateIconTemplate = function () {
        this.iconSlot.clear();
        this.iconSlot.createEmbeddedView(this.node.iconTemplate);
    };
    var NavigatorNodeComponent_1;
    NavigatorNodeComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: NavigatorService }
    ]; };
    tslib_1.__decorate([
        ViewChild('icon', { read: ViewContainerRef, static: false })
    ], NavigatorNodeComponent.prototype, "iconSlot", void 0);
    tslib_1.__decorate([
        Input()
    ], NavigatorNodeComponent.prototype, "node", void 0);
    tslib_1.__decorate([
        Input()
    ], NavigatorNodeComponent.prototype, "isRoot", void 0);
    tslib_1.__decorate([
        ViewChild(RouterLinkActive, { static: false })
    ], NavigatorNodeComponent.prototype, "routerLinkActive", void 0);
    tslib_1.__decorate([
        ViewChildren(NavigatorNodeComponent_1)
    ], NavigatorNodeComponent.prototype, "childrenNodes", void 0);
    tslib_1.__decorate([
        Output()
    ], NavigatorNodeComponent.prototype, "nodeClick", void 0);
    tslib_1.__decorate([
        ViewChild(PopoverConfirmComponent, { static: false })
    ], NavigatorNodeComponent.prototype, "confirm", void 0);
    NavigatorNodeComponent = NavigatorNodeComponent_1 = tslib_1.__decorate([
        Component({
            selector: 'c8y-navigator-node-display',
            template: "<div\n  class=\"slot\"\n  [hidden]=\"node.hidden\"\n  (dragstart)=\"node.dragStart($event)\"\n  (dragend)=\"node.dragEnd($event)\"\n  (drop)=\"node.drop($event)\"\n  [draggable]=\"node.draggable\"\n  [ngClass]=\"{ dragged: node.dragged }\"\n>\n  <ng-container>\n    <a\n      class=\"link\"\n      draggable=\"false\"\n      (dragover)=\"node.canDrop && $event.preventDefault()\"\n      (dragenter)=\"node.canDrop && node.dragEnter($event)\"\n      (dragleave)=\"node.canDrop && node.dragLeave($event)\"\n      title=\"{{node.label | translate}}\"\n      [attr.id]=\"isRoot ? node.id : undefined\"\n      [routerLink]=\"node.canNavigate ? node.path : undefined\"\n      [routerLinkActive]=\"node.canNavigate ? 'active' : ''\"\n      [routerLinkActiveOptions]=\"{exact:node.routerLinkExact}\"\n      (click)=\"click(node.canNavigate ? 'link' : 'expander', $event)\"\n      [ngClass]=\"{'root-link':isRoot, open: node.open, parent: node.hasChildren, 'dragged-hover': node.draggedHover && !node.dragged}\"\n    >\n      <ng-container *ngTemplateOutlet=\"inner\"></ng-container>\n    </a>\n  </ng-container>\n\n  <div\n    class=\"children panel-expand expand\"\n    *ngIf=\"node.children.length\"\n    [collapse]=\"!node.open\"\n    [isAnimated]=\"true\"\n  >\n    <c8y-navigator-node-display\n      *ngFor=\"let childNode of node.children\"\n      [node]=\"childNode\"\n      (nodeClick)=\"nodeClick.emit($event)\"\n    >\n    </c8y-navigator-node-display>\n  </div>\n</div>\n\n<ng-template #inner>\n  <!-- loader -->\n  <i\n    class=\"icon-spin loadingIndicator\"\n    [c8yIcon]=\"'circle-o-notch'\"\n    *ngIf=\"node.loading && !isRoot\"\n  >\n  </i>\n\n  <!-- icon -->\n  <div (click)=\"click('icon', $event)\">\n    <ng-container #icon></ng-container>\n  </div>\n\n  <!--title  -->\n  <span>{{node.label | translate}}</span>\n\n  <i\n    class=\"expander\"\n    [c8yIcon]=\"'chevron-down'\"\n    *ngIf=\"node.hasChildren\"\n    (click)=\"click('expander', $event)\"\n    title=\"{{expandTitle}}\"\n  >\n  </i>\n\n  <c8y-popover-confirm\n    outsideClick=\"true\"\n    containerClass=\"navigator-popover\"\n  ></c8y-popover-confirm>\n</ng-template>\n"
        })
    ], NavigatorNodeComponent);
    return NavigatorNodeComponent;
}());
export { NavigatorNodeComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdG9yLW5vZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvcmUvbmF2aWdhdG9yL25hdmlnYXRvci1ub2RlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMkNBQTJDO0FBQzNDLE9BQU8sRUFDTCxTQUFTLEVBQ1Qsd0JBQXdCLEVBQ3hCLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULFlBQVksRUFDWixnQkFBZ0IsRUFDaEIsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDbkQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFRN0U7O0dBRUc7QUFLSDtJQWdERSxnQ0FDVSx3QkFBa0QsRUFDbEQsU0FBMkI7UUFEM0IsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQXhCckM7Ozs7Ozs7V0FPRztRQUNPLGNBQVMsR0FBeUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQWlCNUQsQ0FBQzsrQkFuRE8sc0JBQXNCO0lBcURqQzs7T0FFRztJQUNILGdEQUFlLEdBQWY7UUFBQSxpQkFRQztRQVBDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLEtBQUksQ0FBQyxFQUFyQixDQUFxQixDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLGVBQWUsR0FBRyxVQUFVLENBQUM7WUFDaEMsS0FBSSxDQUFDLFVBQVUsRUFB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QUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDM0QsQ0FBQzs7O2dCQTlIbUMsd0JBQXdCO2dCQUN2QyxnQkFBZ0I7O0lBOUN5QjtRQUE3RCxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQzs0REFBNEI7SUFLaEY7UUFBUixLQUFLLEVBQUU7d0RBQXFCO0lBS3BCO1FBQVIsS0FBSyxFQUFFOzBEQUFpQjtJQUt1QjtRQUEvQyxTQUFTLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7b0VBQW9DO0lBSzdDO1FBQXJDLFlBQVksQ0FBQyx3QkFBc0IsQ0FBQztpRUFBa0Q7SUFVN0U7UUFBVCxNQUFNLEVBQUU7NkRBQXNEO0lBS1I7UUFBdEQsU0FBUyxDQUFDLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDOzJEQUFrQztJQXZDN0Usc0JBQXNCO1FBSmxDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSw0QkFBNEI7WUFDdEMsb25FQUE4QztTQUMvQyxDQUFDO09BQ1csc0JBQXNCLENBZ0xsQztJQUFELDZCQUFDO0NBQUEsQUFoTEQsSUFnTEM7U0FoTFksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIElucHV0LFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NoaWxkcmVuLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyTGlua0FjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBOYXZpZ2F0b3JJY29uQ29tcG9uZW50IH0gZnJvbSAnLi9uYXZpZ2F0b3ItaWNvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgTmF2aWdhdG9yTm9kZSwgQ2xpY2tPcHRpb25zIH0gZnJvbSAnLi9uYXZpZ2F0b3Itbm9kZSc7XG5pbXBvcnQgeyBOYXZpZ2F0b3JTZXJ2aWNlIH0gZnJvbSAnLi9uYXZpZ2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBQb3BvdmVyQ29uZmlybUNvbXBvbmVudCB9IGZyb20gJy4uL21vZGFsL3BvcG92ZXItY29uZmlybS5jb21wb25lbnQnO1xuXG5leHBvcnQgY29uc3QgZW51bSBDbGlja0V2ZW50U291cmNlIHtcbiAgSUNPTiA9ICdpY29uJyxcbiAgRVhQQU5ERVIgPSAnZXhwYW5kZXInLFxuICBMSU5LID0gJ2xpbmsnXG59XG5cbi8qKlxuICogTmF2aWdhdG9yIG5vZGUgcmVuZGVyZXIuXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1uYXZpZ2F0b3Itbm9kZS1kaXNwbGF5JyxcbiAgdGVtcGxhdGVVcmw6ICcuL25hdmlnYXRvci1ub2RlLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBOYXZpZ2F0b3JOb2RlQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ2ljb24nLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYsIHN0YXRpYzogZmFsc2UgfSkgaWNvblNsb3Q6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgLyoqXG4gICAqIE5hdmlnYXRvciBub2RlLlxuICAgKi9cbiAgQElucHV0KCkgbm9kZTogTmF2aWdhdG9yTm9kZTtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBuYXZpZ2F0b3Igbm9kZSBpcyBhIHJvb3Qgbm9kZSAodG9wIG5vZGUgaW4gdGhlIGhpZXJhcmNoeSkuXG4gICAqL1xuICBASW5wdXQoKSBpc1Jvb3Q6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIEBWaWV3Q2hpbGQoUm91dGVyTGlua0FjdGl2ZSwgeyBzdGF0aWM6IGZhbHNlIH0pIHJvdXRlckxpbmtBY3RpdmU6IFJvdXRlckxpbmtBY3RpdmU7XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIEBWaWV3Q2hpbGRyZW4oTmF2aWdhdG9yTm9kZUNvbXBvbmVudCkgY2hpbGRyZW5Ob2RlczogUXVlcnlMaXN0PE5hdmlnYXRvck5vZGVDb21wb25lbnQ+O1xuXG4gIC8qKlxuICAgKiBFdmVudCBlbWl0dGVyIHJlc3BvbnNpYmxlIGZvciBicm9hZGNhc3Rpbmcgb25lIG9mIHRoZSBmb2xsb3dpbmcgZXZlbnRzOiBcImljb25cIiwgXCJleHBhbmRlclwiIG9yIFwibGlua1wiIGFzIHN0cmluZyB2YWx1ZS5cbiAgICpcbiAgICogVGhlIHR5cGUgb2YgZXZlbnQgZGVwZW5kcyBvbiB3aGVyZSB5b3UgY2xpY2sgb24gdGhlIG5hdmlnYXRvciBub2RlOlxuICAgKiAqIGNsaWNraW5nIHRoZSBpY29uIHdpbGwgYnJvYWRjYXN0IHRoZSBldmVudCBcImljb25cIixcbiAgICogKiBjbGlja2luZyB0aGUgZXhwYW5kZXIgd2lsbCBicm9hZGNhc3QgdGhlIGV2ZW50IFwiZXhwYW5kZXJcIixcbiAgICogKiBjbGlja2luZyB0aGUgbGFiZWwgd2lsbCBicm9hZGNhc3QgdGhlIGV2ZW50IFwibGlua1wiLlxuICAgKi9cbiAgQE91dHB1dCgpIG5vZGVDbGljazogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIEBWaWV3Q2hpbGQoUG9wb3ZlckNvbmZpcm1Db21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSBjb25maXJtOiBQb3BvdmVyQ29uZmlybUNvbXBvbmVudDtcblxuICAvKipcbiAgICogUGFyZW50IG5vZGUgcmVuZGVyZXIuXG4gICAqL1xuICBwYXJlbnROb2RlOiBOYXZpZ2F0b3JOb2RlQ29tcG9uZW50O1xuXG4gIHByaXZhdGUgdmlld0luaXRUaW1lb3V0O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBuYXZpZ2F0b3I6IE5hdmlnYXRvclNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5jaGlsZHJlbk5vZGVzLmZvckVhY2gobiA9PiAobi5wYXJlbnROb2RlID0gdGhpcykpO1xuICAgIHRoaXMudmlld0luaXRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZUljb24oKTtcbiAgICAgIHRoaXMub3Blbk9uRmlyc3RVcmwoKTtcbiAgICAgIHRoaXMuZXhwYW5kUGFyZW50SWZBY3RpdmUoKTtcbiAgICAgIHRoaXMubm9kZS5jb25maXJtID0gdGhpcy5jb25maXJtO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cGFuZHMgdGhlIG5hdmlnYXRvciBub2RlIHdoZW4gdGhlIFVSTCBtYXRjaGVzIHRoZSBwYXRoIHByb3ZpZGVkIGluIHRoZSBub2RlLlxuICAgKi9cbiAgb3Blbk9uRmlyc3RVcmwoKSB7XG4gICAgaWYgKHRoaXMubmF2aWdhdG9yLm9wZW5PbkZpcnN0VXJsKHRoaXMubm9kZSkgJiYgIXRoaXMubm9kZS5vcGVuKSB7XG4gICAgICB0aGlzLmV4cGFuZENvbGxhcHNlKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBleHBhbmRlciB0aXRsZS5cbiAgICovXG4gIGdldCBleHBhbmRUaXRsZSgpIHtcbiAgICByZXR1cm4gIXRoaXMubm9kZS5vcGVuID8gJ0V4cGFuZCcgOiAnQ29sbGFwc2UnO1xuICB9XG5cbiAgLyoqXG4gICAqIENsaWNrIGV2ZW50IGhhbmRsZXIuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmcm9tIFNvdXJjZSBvZiB0aGUgY2xpY2sgZXZlbnQuXG4gICAqIEBwYXJhbSBldmVudCBET00gZXZlbnQuXG4gICAqL1xuICBjbGljayhmcm9tOiAnaWNvbicgfCAnZXhwYW5kZXInIHwgJ2xpbmsnID0gJ2xpbmsnLCAkZXZlbnQ/OiBNb3VzZUV2ZW50KSB7XG4gICAgbGV0IG9wZW46IGJvb2xlYW47XG5cbiAgICBzd2l0Y2ggKGZyb20pIHtcbiAgICAgIGNhc2UgQ2xpY2tFdmVudFNvdXJjZS5FWFBBTkRFUjpcbiAgICAgICAgaWYgKCRldmVudCkge1xuICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgICBvcGVuID0gIXRoaXMubm9kZS5vcGVuO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ2xpY2tFdmVudFNvdXJjZS5JQ09OOlxuICAgICAgY2FzZSBDbGlja0V2ZW50U291cmNlLkxJTks6XG4gICAgICAgIG9wZW4gPSB0aGlzLnJvdXRlckxpbmtBY3RpdmUgJiYgdGhpcy5yb3V0ZXJMaW5rQWN0aXZlLmlzQWN0aXZlID8gdHJ1ZSA6ICF0aGlzLm5vZGUub3BlbjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHRoaXMuaGFuZGxlRXhwYW5kQ29sbGFwc2Uob3BlbiwgZnJvbSwgJGV2ZW50KTtcbiAgICB0aGlzLm5vZGVDbGljay5lbWl0KGZyb20pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cGFuZHMgb3IgY29sbGFwc2VzIHRoZSBuYXZpZ2F0b3Igbm9kZSBhbmQgaXRzIGNoaWxkcmVuIHJlY3Vyc2l2ZWx5LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wZW4gT3BlbiBvciBjbG9zZSB0aGUgbm9kZS5cbiAgICogQHBhcmFtIHtib29sZWFufSByZWN1cnNpdmUgT3BlbiBvciBjbG9zZSB0aGUgY2hpbGRyZW4uXG4gICAqIEBwYXJhbSB7Q2xpY2tPcHRpb25zfSBmb3JOb2RlIENsaWNrIG9wdGlvbnMuXG4gICAqL1xuICBleHBhbmRDb2xsYXBzZShvcGVuLCByZWN1cnNpdmU/LCBmb3JOb2RlOiBDbGlja09wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMubm9kZS5vcGVuID0gb3BlbjtcbiAgICBpZiAocmVjdXJzaXZlKSB7XG4gICAgICB0aGlzLmNoaWxkcmVuTm9kZXMuZm9yRWFjaChuID0+IG4uZXhwYW5kQ29sbGFwc2Uob3BlbiwgcmVjdXJzaXZlKSk7XG4gICAgfVxuICAgIGZvck5vZGUub3BlbiA9IG9wZW47XG4gICAgdGhpcy5ub2RlLmNsaWNrKGZvck5vZGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnZpZXdJbml0VGltZW91dCk7XG5cbiAgICBpZiAodGhpcy5ub2RlKSB7XG4gICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXhwYW5kQ29sbGFwc2Uob3BlbiwgZnJvbSwgJGV2ZW50KSB7XG4gICAgaWYgKFxuICAgICAgb3BlbiA9PT0gdGhpcy5ub2RlLm9wZW4gfHxcbiAgICAgICh0aGlzLm5vZGUucGF0aCAmJiAhb3BlbiAmJiBmcm9tICE9PSBDbGlja0V2ZW50U291cmNlLkVYUEFOREVSKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmV4cGFuZENvbGxhcHNlKG9wZW4sIGZhbHNlLCB7IFtmcm9tXTogdHJ1ZSwgJGV2ZW50IH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBleHBhbmRQYXJlbnRJZkFjdGl2ZSgpIHtcbiAgICBpZiAodGhpcy5yb3V0ZXJMaW5rQWN0aXZlICYmIHRoaXMucm91dGVyTGlua0FjdGl2ZS5pc0FjdGl2ZSAmJiB0aGlzLnBhcmVudE5vZGUpIHtcbiAgICAgIHRoaXMucGFyZW50Tm9kZS5leHBhbmRDb2xsYXBzZSh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUljb24oKSB7XG4gICAgaWYgKHRoaXMubm9kZS5pY29uVGVtcGxhdGUpIHtcbiAgICAgIHRoaXMudXBkYXRlSWNvblRlbXBsYXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlSWNvbkNvbXBvbmVudCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlSWNvbkNvbXBvbmVudCgpIHtcbiAgICBsZXQgY29tcG9uZW50VHlwZSA9IE5hdmlnYXRvckljb25Db21wb25lbnQ7XG4gICAgaWYgKHRoaXMubm9kZSAmJiB0aGlzLm5vZGUuaWNvbkNvbXBvbmVudCkge1xuICAgICAgY29tcG9uZW50VHlwZSA9IHRoaXMubm9kZS5pY29uQ29tcG9uZW50O1xuICAgIH1cbiAgICB0aGlzLmljb25TbG90LmNsZWFyKCk7XG4gICAgY29uc3QgaWNvbkNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShcbiAgICAgIGNvbXBvbmVudFR5cGVcbiAgICApO1xuICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHRoaXMuaWNvblNsb3QuY3JlYXRlQ29tcG9uZW50KGljb25Db21wb25lbnRGYWN0b3J5KTtcbiAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Uubm9kZSA9IHRoaXMubm9kZTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlSWNvblRlbXBsYXRlKCkge1xuICAgIHRoaXMuaWNvblNsb3QuY2xlYXIoKTtcbiAgICB0aGlzLmljb25TbG90LmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLm5vZGUuaWNvblRlbXBsYXRlKTtcbiAgfVxufVxuIl19