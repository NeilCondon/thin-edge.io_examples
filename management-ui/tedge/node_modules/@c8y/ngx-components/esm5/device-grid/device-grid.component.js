import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { DataGridComponent, FilteringActionType, gettext } from '@c8y/ngx-components';
import { DeviceGridService } from './device-grid.service';
var DeviceGridComponent = /** @class */ (function () {
    function DeviceGridComponent(deviceGridService) {
        this.deviceGridService = deviceGridService;
        this.title = gettext('Devices');
        this.loadMoreItemsLabel = gettext('Load more devices');
        this.loadingItemsLabel = gettext('Loading devicesâ€¦');
        this.selectable = false;
        this.baseQuery = {};
        this.showChildDevices = {};
        this.onColumnsChange = new EventEmitter();
        this.onDeviceQueryStringChange = new EventEmitter();
        this.itemsSelect = new EventEmitter();
        this.onChildDevices = new EventEmitter();
        this.columns = this.deviceGridService.getDefaultColumns();
        this.pagination = this.deviceGridService.getDefaultPagination();
        this.actionControls = this.deviceGridService.getDefaultActionControls();
        this.bulkActionControls = this.deviceGridService.getDefaultBulkActionControls();
        this.withChildren = false;
        this.serverSideDataCallback = this.onDataSourceModifier.bind(this);
    }
    Object.defineProperty(DeviceGridComponent.prototype, "_columns", {
        set: function (value) {
            if (value) {
                this.columns = this.deviceGridService.getUserConfiguredColumns(value);
            }
            else {
                this.columns = this.deviceGridService.getUserConfiguredColumns(this.deviceGridService.getDefaultColumns());
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DeviceGridComponent.prototype, "_pagination", {
        set: function (value) {
            if (value) {
                this.pagination = value;
            }
            else {
                this.pagination = this.deviceGridService.getDefaultPagination();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DeviceGridComponent.prototype, "_infiniteScroll", {
        set: function (infiniteScroll) {
            this.infiniteScroll = infiniteScroll;
            this.pagination = this.deviceGridService.getInfiniteScrollPagination();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DeviceGridComponent.prototype, "_actionControls", {
        set: function (value) {
            if (value) {
                this.actionControls = value;
            }
            else {
                this.actionControls = this.deviceGridService.getDefaultActionControls();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DeviceGridComponent.prototype, "_bulkActionControls", {
        set: function (value) {
            if (value) {
                this.bulkActionControls = value;
            }
            else {
                this.bulkActionControls = this.deviceGridService.getDefaultBulkActionControls();
            }
        },
        enumerable: true,
        configurable: true
    });
    DeviceGridComponent.prototype.trackByName = function (_index, column) {
        return column.name;
    };
    DeviceGridComponent.prototype.onDataSourceModifier = function (dataSourceModifier) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var serverSideDataResult, _a, res, data, paging, filteredSize, size;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.deviceGridService.getData(dataSourceModifier.columns, dataSourceModifier.pagination, this.baseQuery, this.withChildren)];
                    case 1:
                        _a = _b.sent(), res = _a.res, data = _a.data, paging = _a.paging;
                        return [4 /*yield*/, this.deviceGridService.getCount(dataSourceModifier.columns, dataSourceModifier.pagination, this.baseQuery)];
                    case 2:
                        filteredSize = _b.sent();
                        return [4 /*yield*/, this.deviceGridService.getTotal(this.baseQuery)];
                    case 3:
                        size = _b.sent();
                        this.onColumnsChange.emit(dataSourceModifier.columns);
                        this.onDeviceQueryStringChange.emit(this.deviceGridService.getDeviceQueryString(dataSourceModifier.columns, this.baseQuery));
                        serverSideDataResult = {
                            res: res,
                            data: data,
                            paging: paging,
                            filteredSize: filteredSize,
                            size: size
                        };
                        if (this.dataCallback) {
                            serverSideDataResult = this.dataCallback(serverSideDataResult);
                        }
                        return [2 /*return*/, serverSideDataResult];
                }
            });
        });
    };
    DeviceGridComponent.prototype.updateFiltering = function (columnNames, action) {
        var type = action.type;
        if (type === FilteringActionType.ResetFilter) {
            this.dataGrid.clearFilters();
        }
        else {
            this.dataGrid.updateFiltering(columnNames, action);
        }
    };
    DeviceGridComponent.prototype.configChange = function (config) {
        this.deviceGridService.saveConfig(config);
    };
    DeviceGridComponent.ctorParameters = function () { return [
        { type: DeviceGridService }
    ]; };
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "dataCallback", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "refresh", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "title", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "itemsSelectLimit", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "loadMoreItemsLabel", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "loadingItemsLabel", void 0);
    tslib_1.__decorate([
        Input('columns')
    ], DeviceGridComponent.prototype, "_columns", null);
    tslib_1.__decorate([
        Input('pagination')
    ], DeviceGridComponent.prototype, "_pagination", null);
    tslib_1.__decorate([
        Input('infiniteScroll')
    ], DeviceGridComponent.prototype, "_infiniteScroll", null);
    tslib_1.__decorate([
        Input('actionControls')
    ], DeviceGridComponent.prototype, "_actionControls", null);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "selectable", void 0);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "baseQuery", void 0);
    tslib_1.__decorate([
        Input('bulkActionControls')
    ], DeviceGridComponent.prototype, "_bulkActionControls", null);
    tslib_1.__decorate([
        Input()
    ], DeviceGridComponent.prototype, "showChildDevices", void 0);
    tslib_1.__decorate([
        Output()
    ], DeviceGridComponent.prototype, "onColumnsChange", void 0);
    tslib_1.__decorate([
        Output()
    ], DeviceGridComponent.prototype, "onDeviceQueryStringChange", void 0);
    tslib_1.__decorate([
        Output()
    ], DeviceGridComponent.prototype, "itemsSelect", void 0);
    tslib_1.__decorate([
        Output()
    ], DeviceGridComponent.prototype, "onChildDevices", void 0);
    tslib_1.__decorate([
        ViewChild(DataGridComponent, { static: true })
    ], DeviceGridComponent.prototype, "dataGrid", void 0);
    DeviceGridComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-device-grid',
            template: "<c8y-data-grid\n  [title]=\"title\"\n  [loadMoreItemsLabel]=\"loadMoreItemsLabel\"\n  [loadingItemsLabel]=\"loadingItemsLabel\"\n  [columns]=\"columns\"\n  [pagination]=\"pagination\"\n  [infiniteScroll]=\"infiniteScroll\"\n  [actionControls]=\"actionControls\"\n  [selectable]=\"selectable\"\n  [bulkActionControls]=\"bulkActionControls\"\n  [serverSideDataCallback]=\"serverSideDataCallback\"\n  [itemsSelectLimit]=\"itemsSelectLimit\"\n  (itemsSelect)=\"itemsSelect.emit($event)\"\n  (onConfigChange)=\"configChange($event)\"\n  [refresh]=\"refresh\"\n  [showChildDevices]=\"showChildDevices\"\n  (onChildDevices)=\"withChildren=$event;onChildDevices.emit($event)\"\n>\n  <div class=\"c8y-empty-state\">\n    <h1 c8yIcon=\"search\"></h1>\n    <div>\n      <p>\n        <strong>{{ 'No matching devices.' | translate }}</strong>\n      </p>\n      <small>{{ 'Refine your search terms' | translate }}</small>\n    </div>\n  </div>\n  <ng-container *ngFor=\"let column of columns; trackBy: trackByName\">\n    <c8y-column [name]=\"column.name\"></c8y-column>\n  </ng-container>\n</c8y-data-grid>\n"
        })
    ], DeviceGridComponent);
    return DeviceGridComponent;
}());
export { DeviceGridComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLWdyaWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9kZXZpY2UtZ3JpZC8iLCJzb3VyY2VzIjpbImRldmljZS1ncmlkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUdMLGlCQUFpQixFQUVqQixtQkFBbUIsRUFFbkIsT0FBTyxFQUtSLE1BQU0scUJBQXFCLENBQUM7QUFFN0IsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFNMUQ7SUE4REUsNkJBQW1CLGlCQUFvQztRQUFwQyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBM0Q5QyxVQUFLLEdBQVcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRW5DLHVCQUFrQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2xELHNCQUFpQixHQUFXLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBNkJ4RCxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCLGNBQVMsR0FBUSxFQUFFLENBQUM7UUFRcEIscUJBQWdCLEdBQVEsRUFBRSxDQUFDO1FBQzFCLG9CQUFlLEdBQXFDLElBQUksWUFBWSxFQUUzRSxDQUFDO1FBQ00sOEJBQXlCLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFDN0UsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBWSxDQUFDO1FBQzNDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUV2RCxZQUFPLEdBQXVCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pFLGVBQVUsR0FBZSxJQUFJLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUN2RSxtQkFB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QUU7a0VBQXlEO0lBQy9DO1FBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7dURBUWhCO0lBQ29CO1FBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7MERBTW5CO0lBRXdCO1FBQXhCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQzs4REFHdkI7SUFDd0I7UUFBeEIsS0FBSyxDQUFDLGdCQUFnQixDQUFDOzhEQU12QjtJQUNRO1FBQVIsS0FBSyxFQUFFOzJEQUE2QjtJQUM1QjtRQUFSLEtBQUssRUFBRTswREFBcUI7SUFDQTtRQUE1QixLQUFLLENBQUMsb0JBQW9CLENBQUM7a0VBTTNCO0lBQ1E7UUFBUixLQUFLLEVBQUU7aUVBQTRCO0lBQzFCO1FBQVQsTUFBTSxFQUFFO2dFQUVMO0lBQ007UUFBVCxNQUFNLEVBQUU7MEVBQThFO0lBQzdFO1FBQVQsTUFBTSxFQUFFOzREQUE0QztJQUMzQztRQUFULE1BQU0sRUFBRTsrREFBOEM7SUFVdkQ7UUFEQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7eURBQ25CO0lBNURqQixtQkFBbUI7UUFKL0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGlCQUFpQjtZQUMzQixvbENBQTJDO1NBQzVDLENBQUM7T0FDVyxtQkFBbUIsQ0E4SC9CO0lBQUQsMEJBQUM7Q0FBQSxBQTlIRCxJQThIQztTQTlIWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBBY3Rpb25Db250cm9sLFxuICBCdWxrQWN0aW9uQ29udHJvbCxcbiAgRGF0YUdyaWRDb21wb25lbnQsXG4gIERhdGFTb3VyY2VNb2RpZmllcixcbiAgRmlsdGVyaW5nQWN0aW9uVHlwZSxcbiAgRmlsdGVyaW5nTW9kaWZpZXIsXG4gIGdldHRleHQsXG4gIExvYWRNb3JlTW9kZSxcbiAgUGFnaW5hdGlvbixcbiAgU2VydmVyU2lkZURhdGFSZXN1bHQsXG4gIEdyaWRDb25maWdcbn0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBEZXZpY2VHcmlkQ29sdW1uLCBEYXRhQ2FsbGJhY2sgfSBmcm9tICcuL2RldmljZS1ncmlkLm1vZGVscyc7XG5pbXBvcnQgeyBEZXZpY2VHcmlkU2VydmljZSB9IGZyb20gJy4vZGV2aWNlLWdyaWQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1kZXZpY2UtZ3JpZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9kZXZpY2UtZ3JpZC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRGV2aWNlR3JpZENvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGRhdGFDYWxsYmFjazogRGF0YUNhbGxiYWNrO1xuICBASW5wdXQoKSByZWZyZXNoOiBFdmVudEVtaXR0ZXI8YW55PjtcbiAgQElucHV0KCkgdGl0bGU6IHN0cmluZyA9IGdldHRleHQoJ0RldmljZXMnKTtcbiAgQElucHV0KCkgaXRlbXNTZWxlY3RMaW1pdDogbnVtYmVyO1xuICBASW5wdXQoKSBsb2FkTW9yZUl0ZW1zTGFiZWwgPSBnZXR0ZXh0KCdMb2FkIG1vcmUgZGV2aWNlcycpO1xuICBASW5wdXQoKSBsb2FkaW5nSXRlbXNMYWJlbDogc3RyaW5nID0gZ2V0dGV4dCgnTG9hZGluZyBkZXZpY2Vz4oCmJyk7XG4gIEBJbnB1dCgnY29sdW1ucycpIHNldCBfY29sdW1ucyh2YWx1ZTogRGV2aWNlR3JpZENvbHVtbltdKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLmRldmljZUdyaWRTZXJ2aWNlLmdldFVzZXJDb25maWd1cmVkQ29sdW1ucyh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY29sdW1ucyA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0VXNlckNvbmZpZ3VyZWRDb2x1bW5zKFxuICAgICAgICB0aGlzLmRldmljZUdyaWRTZXJ2aWNlLmdldERlZmF1bHRDb2x1bW5zKClcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIEBJbnB1dCgncGFnaW5hdGlvbicpIHNldCBfcGFnaW5hdGlvbih2YWx1ZTogUGFnaW5hdGlvbikge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5wYWdpbmF0aW9uID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucGFnaW5hdGlvbiA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdFBhZ2luYXRpb24oKTtcbiAgICB9XG4gIH1cbiAgaW5maW5pdGVTY3JvbGw6IExvYWRNb3JlTW9kZTtcbiAgQElucHV0KCdpbmZpbml0ZVNjcm9sbCcpIHNldCBfaW5maW5pdGVTY3JvbGwoaW5maW5pdGVTY3JvbGw6IExvYWRNb3JlTW9kZSkge1xuICAgIHRoaXMuaW5maW5pdGVTY3JvbGwgPSBpbmZpbml0ZVNjcm9sbDtcbiAgICB0aGlzLnBhZ2luYXRpb24gPSB0aGlzLmRldmljZUdyaWRTZXJ2aWNlLmdldEluZmluaXRlU2Nyb2xsUGFnaW5hdGlvbigpO1xuICB9XG4gIEBJbnB1dCgnYWN0aW9uQ29udHJvbHMnKSBzZXQgX2FjdGlvbkNvbnRyb2xzKHZhbHVlOiBBY3Rpb25Db250cm9sW10pIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuYWN0aW9uQ29udHJvbHMgPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hY3Rpb25Db250cm9scyA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdEFjdGlvbkNvbnRyb2xzKCk7XG4gICAgfVxuICB9XG4gIEBJbnB1dCgpIHNlbGVjdGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgYmFzZVF1ZXJ5OiBhbnkgPSB7fTtcbiAgQElucHV0KCdidWxrQWN0aW9uQ29udHJvbHMnKSBzZXQgX2J1bGtBY3Rpb25Db250cm9scyh2YWx1ZTogQnVsa0FjdGlvbkNvbnRyb2xbXSkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5idWxrQWN0aW9uQ29udHJvbHMgPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idWxrQWN0aW9uQ29udHJvbHMgPSB0aGlzLmRldmljZUdyaWRTZXJ2aWNlLmdldERlZmF1bHRCdWxrQWN0aW9uQ29udHJvbHMoKTtcbiAgICB9XG4gIH1cbiAgQElucHV0KCkgc2hvd0NoaWxkRGV2aWNlczogYW55ID0ge307XG4gIEBPdXRwdXQoKSBvbkNvbHVtbnNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxEZXZpY2VHcmlkQ29sdW1uW10+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBEZXZpY2VHcmlkQ29sdW1uW11cbiAgPigpO1xuICBAT3V0cHV0KCkgb25EZXZpY2VRdWVyeVN0cmluZ0NoYW5nZTogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgQE91dHB1dCgpIGl0ZW1zU2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmdbXT4oKTtcbiAgQE91dHB1dCgpIG9uQ2hpbGREZXZpY2VzID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIGNvbHVtbnM6IERldmljZUdyaWRDb2x1bW5bXSA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdENvbHVtbnMoKTtcbiAgcGFnaW5hdGlvbjogUGFnaW5hdGlvbiA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdFBhZ2luYXRpb24oKTtcbiAgYWN0aW9uQ29udHJvbHM6IEFjdGlvbkNvbnRyb2xbXSA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdEFjdGlvbkNvbnRyb2xzKCk7XG4gIGJ1bGtBY3Rpb25Db250cm9sczogQnVsa0FjdGlvbkNvbnRyb2xbXSA9IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGVmYXVsdEJ1bGtBY3Rpb25Db250cm9scygpO1xuICBzZXJ2ZXJTaWRlRGF0YUNhbGxiYWNrOiBhbnk7XG4gIHdpdGhDaGlsZHJlbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoRGF0YUdyaWRDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pXG4gIGRhdGFHcmlkOiBEYXRhR3JpZENvbXBvbmVudDtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZGV2aWNlR3JpZFNlcnZpY2U6IERldmljZUdyaWRTZXJ2aWNlKSB7XG4gICAgdGhpcy5zZXJ2ZXJTaWRlRGF0YUNhbGxiYWNrID0gdGhpcy5vbkRhdGFTb3VyY2VNb2RpZmllci5iaW5kKHRoaXMpO1xuICB9XG5cbiAgdHJhY2tCeU5hbWUoX2luZGV4LCBjb2x1bW46IERldmljZUdyaWRDb2x1bW4pOiBzdHJpbmcge1xuICAgIHJldHVybiBjb2x1bW4ubmFtZTtcbiAgfVxuXG4gIGFzeW5jIG9uRGF0YVNvdXJjZU1vZGlmaWVyKFxuICAgIGRhdGFTb3VyY2VNb2RpZmllcjogRGF0YVNvdXJjZU1vZGlmaWVyXG4gICk6IFByb21pc2U8U2VydmVyU2lkZURhdGFSZXN1bHQ+IHtcbiAgICBsZXQgc2VydmVyU2lkZURhdGFSZXN1bHQ6IFNlcnZlclNpZGVEYXRhUmVzdWx0O1xuICAgIGNvbnN0IHsgcmVzLCBkYXRhLCBwYWdpbmcgfSA9IGF3YWl0IHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGF0YShcbiAgICAgIGRhdGFTb3VyY2VNb2RpZmllci5jb2x1bW5zLFxuICAgICAgZGF0YVNvdXJjZU1vZGlmaWVyLnBhZ2luYXRpb24sXG4gICAgICB0aGlzLmJhc2VRdWVyeSxcbiAgICAgIHRoaXMud2l0aENoaWxkcmVuXG4gICAgKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkU2l6ZTogbnVtYmVyID0gYXdhaXQgdGhpcy5kZXZpY2VHcmlkU2VydmljZS5nZXRDb3VudChcbiAgICAgIGRhdGFTb3VyY2VNb2RpZmllci5jb2x1bW5zLFxuICAgICAgZGF0YVNvdXJjZU1vZGlmaWVyLnBhZ2luYXRpb24sXG4gICAgICB0aGlzLmJhc2VRdWVyeVxuICAgICk7XG4gICAgY29uc3Qgc2l6ZTogbnVtYmVyID0gYXdhaXQgdGhpcy5kZXZpY2VHcmlkU2VydmljZS5nZXRUb3RhbCh0aGlzLmJhc2VRdWVyeSk7XG5cbiAgICB0aGlzLm9uQ29sdW1uc0NoYW5nZS5lbWl0KGRhdGFTb3VyY2VNb2RpZmllci5jb2x1bW5zKTtcbiAgICB0aGlzLm9uRGV2aWNlUXVlcnlTdHJpbmdDaGFuZ2UuZW1pdChcbiAgICAgIHRoaXMuZGV2aWNlR3JpZFNlcnZpY2UuZ2V0RGV2aWNlUXVlcnlTdHJpbmcoZGF0YVNvdXJjZU1vZGlmaWVyLmNvbHVtbnMsIHRoaXMuYmFzZVF1ZXJ5KVxuICAgICk7XG5cbiAgICBzZXJ2ZXJTaWRlRGF0YVJlc3VsdCA9IHtcbiAgICAgIHJlcyxcbiAgICAgIGRhdGEsXG4gICAgICBwYWdpbmcsXG4gICAgICBmaWx0ZXJlZFNpemUsXG4gICAgICBzaXplXG4gICAgfTtcblxuICAgIGlmICh0aGlzLmRhdGFDYWxsYmFjaykge1xuICAgICAgc2VydmVyU2lkZURhdGFSZXN1bHQgPSB0aGlzLmRhdGFDYWxsYmFjayhzZXJ2ZXJTaWRlRGF0YVJlc3VsdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlcnZlclNpZGVEYXRhUmVzdWx0O1xuICB9XG5cbiAgdXBkYXRlRmlsdGVyaW5nKFxuICAgIGNvbHVtbk5hbWVzOiBzdHJpbmdbXSxcbiAgICBhY3Rpb246IHtcbiAgICAgIHR5cGU6IEZpbHRlcmluZ0FjdGlvblR5cGU7XG4gICAgICBwYXlsb2FkPzogeyBmaWx0ZXJpbmdNb2RpZmllcjogRmlsdGVyaW5nTW9kaWZpZXIgfTtcbiAgICB9XG4gICkge1xuICAgIGNvbnN0IHsgdHlwZSB9ID0gYWN0aW9uO1xuICAgIGlmICh0eXBlID09PSBGaWx0ZXJpbmdBY3Rpb25UeXBlLlJlc2V0RmlsdGVyKSB7XG4gICAgICB0aGlzLmRhdGFHcmlkLmNsZWFyRmlsdGVycygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRhdGFHcmlkLnVwZGF0ZUZpbHRlcmluZyhjb2x1bW5OYW1lcywgYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBjb25maWdDaGFuZ2UoY29uZmlnOiBHcmlkQ29uZmlnKSB7XG4gICAgdGhpcy5kZXZpY2VHcmlkU2VydmljZS5zYXZlQ29uZmlnKGNvbmZpZyk7XG4gIH1cbn1cbiJdfQ==