import * as tslib_1 from "tslib";
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
var StatusFilterComponent = /** @class */ (function () {
    function StatusFilterComponent() {
        this.statusOptions = [];
        this.onFilterChanged = new EventEmitter();
        this.isAllButtonSelected = true;
    }
    Object.defineProperty(StatusFilterComponent.prototype, "options", {
        /** List of filter options to be displayed */
        set: function (options) {
            this.statusOptions = (options || []).map(function (option) { return ({ selected: false, option: option }); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "_multiple", {
        /**
         * Allows multiple options to be active simultaneosly.
         */
        set: function (multiple) {
            this.multiple = coerceBooleanProperty(multiple);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "_small", {
        /** Display the filter as a small button group */
        set: function (small) {
            this.small = coerceBooleanProperty(small);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "displaySmall", {
        get: function () {
            return this.small;
        },
        enumerable: true,
        configurable: true
    });
    StatusFilterComponent.prototype.changeFilter = function (option) {
        this.isAllButtonSelected = false;
        var emitNeeded = false;
        if (this.multiple) {
            option.selected = !option.selected;
            emitNeeded = true;
        }
        else if (!option.selected) {
            option.selected = true;
            this.statusOptions.filter(function (op) { return op !== option; }).forEach(function (op) { return (op.selected = false); });
            emitNeeded = true;
        }
        if (emitNeeded) {
            this.emitSelectedOptions();
        }
    };
    StatusFilterComponent.prototype.removeFilter = function () {
        this.isAllButtonSelected = true;
        this.statusOptions.forEach(function (op) { return (op.selected = false); });
        this.emitSelectedOptions();
    };
    /**
     * Allows the filter to be initalliy displayed with some preset filters.
     *
     * @param filters An `IStatusOption` array defining filter options to be preset.
     * @param emit  (optional) If `true` component will emit `onFilterChanged` event.
     */
    StatusFilterComponent.prototype.preset = function (filters, emit) {
        var _this = this;
        if (emit === void 0) { emit = true; }
        var firstSelected = false;
        this.statusOptions.forEach(function (option) { return (option.selected = false); });
        this.statusOptions
            .filter(function (option) { return (filters || []).map(function (o) { return o.label; }).includes(option.option.label); })
            .filter(function () {
            // only first option passed will be set in single selection mode
            var include = _this.multiple || !firstSelected;
            if (include) {
                firstSelected = true;
            }
            return include;
        })
            .forEach(function (option) { return (option.selected = true); });
        this.isAllButtonSelected = !(filters && filters.length);
        if (emit) {
            this.emitSelectedOptions();
        }
    };
    StatusFilterComponent.prototype.reset = function () {
        this.removeFilter();
    };
    StatusFilterComponent.prototype.activeFilters = function () {
        return this.statusOptions.filter(function (option) { return option.selected; }).map(function (option) { return option.option; });
    };
    StatusFilterComponent.prototype.isFilterApplied = function () {
        return this.statusOptions.some(function (option) { return option.selected; });
    };
    StatusFilterComponent.prototype.emitSelectedOptions = function () {
        this.onFilterChanged.emit(this.statusOptions.filter(function (option) { return option.selected; }).map(function (option) { return option.option; }));
    };
    tslib_1.__decorate([
        Input()
    ], StatusFilterComponent.prototype, "options", null);
    tslib_1.__decorate([
        Input('multiple')
    ], StatusFilterComponent.prototype, "_multiple", null);
    tslib_1.__decorate([
        Input('small')
    ], StatusFilterComponent.prototype, "_small", null);
    tslib_1.__decorate([
        HostBinding('class.btn-group-sm')
    ], StatusFilterComponent.prototype, "displaySmall", null);
    tslib_1.__decorate([
        Output()
    ], StatusFilterComponent.prototype, "onFilterChanged", void 0);
    StatusFilterComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-status-filter',
            template: "<div dropdown \n  placement=\"bottom left\" \n  class=\"dropdown c8y-child-assets-selector\"\n>\n  <button id=\"status-filter\" \n    dropdownToggle \n    type=\"button\" \n    class=\"btn dropdown-toggle d-flex a-i-center c8y-dropdown\"\n    title=\"{{ 'Status filter' | translate}}\"\n    aria-controls=\"dropdown-status-filter\">\n    <span *ngFor=\"let option of statusOptions\" class=\"d-contents\">\n      <span class=\"text-truncate\" *ngIf=\"option.selected\">\n        <i [class]=\"option.option?.iconClass\"></i>\n        <span class=\"m-l-4\">{{ option.option?.label | translate }}</span>\n      </span>\n    </span>\n    <span class=\"text-truncate\" *ngIf=\"isAllButtonSelected\">\n      <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n      {{ 'All statuses' | translate }}\n    </span>\n  </button>\n  <ul id=\"dropdown-status-filter\" \n    *dropdownMenu \n    class=\"dropdown-menu\"\n    role=\"menu\" \n    aria-labelledby=\"status-filter\"\n  >\n    <li *ngFor=\"let option of statusOptions\" [ngClass]=\"{ active: option.selected }\" >\n      <button\n        (click)=\"changeFilter(option)\"\n      >\n        <i [class]=\"option.option?.iconClass\"></i>\n        <span class=\"m-l-4\">{{ option.option?.label | translate }}</span>\n      </button>\n    </li>\n    <li [ngClass]=\"{ active: isAllButtonSelected }\">\n      <button\n        title=\"{{ 'All' | translate }}\"\n        (click)=\"removeFilter()\"\n      >\n        <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n        {{ 'All statuses' | translate }}\n      </button>\n    </li>\n  </ul>\n</div>"
        })
    ], StatusFilterComponent);
    return StatusFilterComponent;
}());
export { StatusFilterComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzL29wZXJhdGlvbnMvc3RhdHVzLWZpbHRlci8iLCJzb3VyY2VzIjpbInN0YXR1cy1maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU9wRjtJQUpBO1FBS0Usa0JBQWEsR0FBd0QsRUFBRSxDQUFDO1FBdUI5RCxvQkFBZSxHQUFrQyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTlFLHdCQUFtQixHQUFZLElBQUksQ0FBQztJQThFdEMsQ0FBQztJQXBHVSxzQkFBSSwwQ0FBTztRQURwQiw2Q0FBNkM7YUFDcEMsVUFBWSxPQUF3QjtZQUMzQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUMsRUFBN0IsQ0FBNkIsQ0FBQyxDQUFDO1FBQ3BGLENBQUM7OztPQUFBO0lBS2tCLHNCQUFJLDRDQUFTO1FBSGhDOztXQUVHO2FBQ2dCLFVBQWMsUUFBaUI7WUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxDQUFDOzs7T0FBQTtJQUdlLHNCQUFJLHlDQUFNO1FBRDFCLGlEQUFpRDthQUNqQyxVQUFXLEtBQWM7WUFDdkMsSUFBSSxDQUFDLEtBQUssR0FBRyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QyxDQUFDOzs7T0FBQTtJQUVrQyxzQkFBSSwrQ0FBWTth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QUFBLE1BQU0sQ0FBQyxRQUFRLEVBQWYsQ0FBZSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLE1BQU0sRUFBYixDQUFhLENBQUMsQ0FBQztJQUMzRixDQUFDO0lBRUQsK0NBQWUsR0FBZjtRQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxNQUFNLENBQUMsUUFBUSxFQUFmLENBQWUsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFTyxtREFBbUIsR0FBM0I7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FDdkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxNQUFNLENBQUMsUUFBUSxFQUFmLENBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxNQUFNLEVBQWIsQ0FBYSxDQUFDLENBQ2xGLENBQUM7SUFDSixDQUFDO0lBbkdRO1FBQVIsS0FBSyxFQUFFO3dEQUVQO0lBS2tCO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7MERBRWpCO0lBR2U7UUFBZixLQUFLLENBQUMsT0FBTyxDQUFDO3VEQUVkO0lBRWtDO1FBQWxDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQzs2REFFakM7SUFFUztRQUFULE1BQU0sRUFBRTtrRUFBcUU7SUF4Qm5FLHFCQUFxQjtRQUpqQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsbUJBQW1CO1lBQzdCLCtrREFBNkM7U0FDOUMsQ0FBQztPQUNXLHFCQUFxQixDQXdHakM7SUFBRCw0QkFBQztDQUFBLEFBeEdELElBd0dDO1NBeEdZLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSG9zdEJpbmRpbmcsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElTdGF0dXNPcHRpb24gfSBmcm9tICcuL3N0YXR1cy1vcHRpb24ubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktc3RhdHVzLWZpbHRlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9zdGF0dXMtZmlsdGVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBTdGF0dXNGaWx0ZXJDb21wb25lbnQge1xuICBzdGF0dXNPcHRpb25zOiBBcnJheTx7IHNlbGVjdGVkOiBib29sZWFuOyBvcHRpb246IElTdGF0dXNPcHRpb24gfT4gPSBbXTtcblxuICAvKiogTGlzdCBvZiBmaWx0ZXIgb3B0aW9ucyB0byBiZSBkaXNwbGF5ZWQgKi9cbiAgQElucHV0KCkgc2V0IG9wdGlvbnMob3B0aW9uczogSVN0YXR1c09wdGlvbltdKSB7XG4gICAgdGhpcy5zdGF0dXNPcHRpb25zID0gKG9wdGlvbnMgfHwgW10pLm1hcChvcHRpb24gPT4gKHsgc2VsZWN0ZWQ6IGZhbHNlLCBvcHRpb24gfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyBtdWx0aXBsZSBvcHRpb25zIHRvIGJlIGFjdGl2ZSBzaW11bHRhbmVvc2x5LlxuICAgKi9cbiAgQElucHV0KCdtdWx0aXBsZScpIHNldCBfbXVsdGlwbGUobXVsdGlwbGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm11bHRpcGxlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG11bHRpcGxlKTtcbiAgfVxuXG4gIC8qKiBEaXNwbGF5IHRoZSBmaWx0ZXIgYXMgYSBzbWFsbCBidXR0b24gZ3JvdXAgKi9cbiAgQElucHV0KCdzbWFsbCcpIHNldCBfc21hbGwoc21hbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNtYWxsID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHNtYWxsKTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuYnRuLWdyb3VwLXNtJykgZ2V0IGRpc3BsYXlTbWFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5zbWFsbDtcbiAgfVxuXG4gIEBPdXRwdXQoKSBvbkZpbHRlckNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxJU3RhdHVzT3B0aW9uW10+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGlzQWxsQnV0dG9uU2VsZWN0ZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIHByaXZhdGUgbXVsdGlwbGU6IGJvb2xlYW47XG4gIHByaXZhdGUgc21hbGw6IGJvb2xlYW47XG5cbiAgY2hhbmdlRmlsdGVyKG9wdGlvbjogeyBzZWxlY3RlZDogYm9vbGVhbjsgb3B0aW9uOiBJU3RhdHVzT3B0aW9uIH0pIHtcbiAgICB0aGlzLmlzQWxsQnV0dG9uU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICBsZXQgZW1pdE5lZWRlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9ICFvcHRpb24uc2VsZWN0ZWQ7XG4gICAgICBlbWl0TmVlZGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKCFvcHRpb24uc2VsZWN0ZWQpIHtcbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICB0aGlzLnN0YXR1c09wdGlvbnMuZmlsdGVyKG9wID0+IG9wICE9PSBvcHRpb24pLmZvckVhY2gob3AgPT4gKG9wLnNlbGVjdGVkID0gZmFsc2UpKTtcbiAgICAgIGVtaXROZWVkZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChlbWl0TmVlZGVkKSB7XG4gICAgICB0aGlzLmVtaXRTZWxlY3RlZE9wdGlvbnMoKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVGaWx0ZXIoKSB7XG4gICAgdGhpcy5pc0FsbEJ1dHRvblNlbGVjdGVkID0gdHJ1ZTtcbiAgICB0aGlzLnN0YXR1c09wdGlvbnMuZm9yRWFjaChvcCA9PiAob3Auc2VsZWN0ZWQgPSBmYWxzZSkpO1xuXG4gICAgdGhpcy5lbWl0U2VsZWN0ZWRPcHRpb25zKCk7XG4gIH1cblxuICAvKipcbiAgICogQWxsb3dzIHRoZSBmaWx0ZXIgdG8gYmUgaW5pdGFsbGl5IGRpc3BsYXllZCB3aXRoIHNvbWUgcHJlc2V0IGZpbHRlcnMuXG4gICAqXG4gICAqIEBwYXJhbSBmaWx0ZXJzIEFuIGBJU3RhdHVzT3B0aW9uYCBhcnJheSBkZWZpbmluZyBmaWx0ZXIgb3B0aW9ucyB0byBiZSBwcmVzZXQuXG4gICAqIEBwYXJhbSBlbWl0ICAob3B0aW9uYWwpIElmIGB0cnVlYCBjb21wb25lbnQgd2lsbCBlbWl0IGBvbkZpbHRlckNoYW5nZWRgIGV2ZW50LlxuICAgKi9cbiAgcHJlc2V0KGZpbHRlcnM6IElTdGF0dXNPcHRpb25bXSwgZW1pdDogYm9vbGVhbiA9IHRydWUpIHtcbiAgICBsZXQgZmlyc3RTZWxlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgdGhpcy5zdGF0dXNPcHRpb25zLmZvckVhY2gob3B0aW9uID0+IChvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZSkpO1xuXG4gICAgdGhpcy5zdGF0dXNPcHRpb25zXG4gICAgICAuZmlsdGVyKG9wdGlvbiA9PiAoZmlsdGVycyB8fCBbXSkubWFwKG8gPT4gby5sYWJlbCkuaW5jbHVkZXMob3B0aW9uLm9wdGlvbi5sYWJlbCkpXG4gICAgICAuZmlsdGVyKCgpID0+IHtcbiAgICAgICAgLy8gb25seSBmaXJzdCBvcHRpb24gcGFzc2VkIHdpbGwgYmUgc2V0IGluIHNpbmdsZSBzZWxlY3Rpb24gbW9kZVxuICAgICAgICBjb25zdCBpbmNsdWRlOiBib29sZWFuID0gdGhpcy5tdWx0aXBsZSB8fCAhZmlyc3RTZWxlY3RlZDtcbiAgICAgICAgaWYgKGluY2x1ZGUpIHtcbiAgICAgICAgICBmaXJzdFNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbmNsdWRlO1xuICAgICAgfSlcbiAgICAgIC5mb3JFYWNoKG9wdGlvbiA9PiAob3B0aW9uLnNlbGVjdGVkID0gdHJ1ZSkpO1xuXG4gICAgdGhpcy5pc0FsbEJ1dHRvblNlbGVjdGVkID0gIShmaWx0ZXJzICYmIGZpbHRlcnMubGVuZ3RoKTtcblxuICAgIGlmIChlbWl0KSB7XG4gICAgICB0aGlzLmVtaXRTZWxlY3RlZE9wdGlvbnMoKTtcbiAgICB9XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLnJlbW92ZUZpbHRlcigpO1xuICB9XG5cbiAgYWN0aXZlRmlsdGVycygpOiBJU3RhdHVzT3B0aW9uW10ge1xuICAgIHJldHVybiB0aGlzLnN0YXR1c09wdGlvbnMuZmlsdGVyKG9wdGlvbiA9PiBvcHRpb24uc2VsZWN0ZWQpLm1hcChvcHRpb24gPT4gb3B0aW9uLm9wdGlvbik7XG4gIH1cblxuICBpc0ZpbHRlckFwcGxpZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzT3B0aW9ucy5zb21lKG9wdGlvbiA9PiBvcHRpb24uc2VsZWN0ZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0U2VsZWN0ZWRPcHRpb25zKCkge1xuICAgIHRoaXMub25GaWx0ZXJDaGFuZ2VkLmVtaXQoXG4gICAgICB0aGlzLnN0YXR1c09wdGlvbnMuZmlsdGVyKG9wdGlvbiA9PiBvcHRpb24uc2VsZWN0ZWQpLm1hcChvcHRpb24gPT4gb3B0aW9uLm9wdGlvbilcbiAgICApO1xuICB9XG59XG4iXX0=