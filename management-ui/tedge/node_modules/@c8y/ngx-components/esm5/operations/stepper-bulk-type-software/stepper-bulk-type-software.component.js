import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { C8yStepper, gettext, ModalService, Status } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { uniq } from 'lodash-es';
import { BaseStepperComponent } from '@c8y/ngx-components/operations/bulk-operation-stepper';
import { SelectSoftwareStepComponent } from './select-software-step.component';
var StepperBulkTypeSoftwareComponent = /** @class */ (function (_super) {
    tslib_1.__extends(StepperBulkTypeSoftwareComponent, _super);
    function StepperBulkTypeSoftwareComponent(modal, translate) {
        var _this = _super.call(this) || this;
        _this.modal = modal;
        _this.translate = translate;
        _this.descriptionTemplateSingle = gettext('Update software to: {{ name }} (version {{ version }})');
        _this.descriptionTemplateOneOther = gettext('Update software to: {{ name }} (version {{ version }}) and one other');
        _this.descriptionTemplateMultiple = gettext('Update software to: {{ name }} (version {{ version }}) and {{ count }} others');
        _this.selectedSoftware = [];
        return _this;
    }
    StepperBulkTypeSoftwareComponent.prototype.onSoftwareSelected = function (selectedItem) {
        this.selectedSoftware = this.selectedSoftware.filter(function (item) { return item.software.id !== selectedItem.software.id; });
        this.selectedSoftware.push(selectedItem);
    };
    StepperBulkTypeSoftwareComponent.prototype.confirmSoftwareSelection = function ($event) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var deviceTypes, ex_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        deviceTypes = this.getUniqueDeviceTypes();
                        this.deviceTypes = deviceTypes;
                        if (!(deviceTypes.length > 1)) return [3 /*break*/, 5];
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.modal.confirm(gettext('Selected software for various device types'), gettext('Operation may fail due to unsupported software. Do you want to proceed?'), Status.WARNING, { ok: gettext('Confirm'), cancel: gettext('Cancel') })];
                    case 2:
                        _a.sent();
                        $event.stepper.next();
                        return [3 /*break*/, 4];
                    case 3:
                        ex_1 = _a.sent();
                        this.selectedSoftware = [];
                        this.selectSoftware.resetSelection();
                        return [3 /*break*/, 4];
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        $event.stepper.next();
                        _a.label = 6;
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    StepperBulkTypeSoftwareComponent.prototype.retrieveOperationPrototype = function () {
        var softwareList = this.selectedSoftware.map(function (item) { return ({
            name: item.software.name,
            version: item.version.c8y_Software.version,
            url: item.version.c8y_Software.url,
            action: item.action
        }); });
        var interpolationParams = {
            name: softwareList[0].name,
            version: softwareList[0].version,
            count: softwareList.length - 1
        };
        var description;
        switch (softwareList.length) {
            case 1:
                description = this.translate.instant(this.descriptionTemplateSingle, interpolationParams);
                break;
            case 2:
                description = this.translate.instant(this.descriptionTemplateOneOther, interpolationParams);
                break;
            default:
                description = this.translate.instant(this.descriptionTemplateMultiple, interpolationParams);
        }
        return {
            name: gettext('Software update'),
            prototype: {
                description: description,
                c8y_SoftwareUpdate: softwareList
            }
        };
    };
    StepperBulkTypeSoftwareComponent.prototype.getUniqueDeviceTypes = function () {
        return uniq(this.selectedSoftware
            .map(function (item) { return item.software.c8y_Filter && item.software.c8y_Filter.type; })
            .filter(function (type) { return !!type; }));
    };
    StepperBulkTypeSoftwareComponent.ctorParameters = function () { return [
        { type: ModalService },
        { type: TranslateService }
    ]; };
    tslib_1.__decorate([
        ViewChild(SelectSoftwareStepComponent, { static: false })
    ], StepperBulkTypeSoftwareComponent.prototype, "selectSoftware", void 0);
    StepperBulkTypeSoftwareComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-stepper-bulk-type-software',
            template: "<c8y-bulk-operation-stepper>\n  <ng-container\n    *customStep=\"\n      'Select software' | translate; \n      completed: !!selectedSoftware.length;\n      buttonsDisabled: !selectedSoftware.length; \n      onNext: confirmSoftwareSelection.bind(this)\"\n  >\n    <c8y-select-software-step\n      (software)=\"onSoftwareSelected($event)\"\n      class=\"d-contents\"\n    ></c8y-select-software-step>\n  </ng-container>\n  <ng-container *customStep=\"'Confirm selected software' | translate\">\n    <c8y-confirm-software-selection-step\n      class=\"d-contents\"\n      [selectedItems]=\"selectedSoftware\"\n    ></c8y-confirm-software-selection-step>\n  </ng-container>\n</c8y-bulk-operation-stepper>\n"
        })
    ], StepperBulkTypeSoftwareComponent);
    return StepperBulkTypeSoftwareComponent;
}(BaseStepperComponent));
export { StepperBulkTypeSoftwareComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlcHBlci1idWxrLXR5cGUtc29mdHdhcmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zL3N0ZXBwZXItYnVsay10eXBlLXNvZnR3YXJlLyIsInNvdXJjZXMiOlsic3RlcHBlci1idWxrLXR5cGUtc29mdHdhcmUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDaEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQUU3RixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQU8vRTtJQUFzRCw0REFBb0I7SUFleEUsMENBQW9CLEtBQW1CLEVBQVUsU0FBMkI7UUFBNUUsWUFDRSxpQkFBTyxTQUNSO1FBRm1CLFdBQUssR0FBTCxLQUFLLENBQWM7UUFBVSxlQUFTLEdBQVQsU0FBUyxDQUFrQjtRQWRuRSwrQkFBeUIsR0FBVyxPQUFPLENBQ2xELHdEQUF3RCxDQUN6RCxDQUFDO1FBQ08saUNBQTJCLEdBQVcsT0FBTyxDQUNwRCxzRUFBc0UsQ0FDdkUsQ0FBQztRQUNPLGlDQUEyQixHQUFXLE9BQU8sQ0FDcEQsK0VBQStFLENBQ2hGLENBQUM7UUFFRixzQkFBZ0IsR0FBd0IsRUFBRSxDQUFDOztJQU0zQyxDQUFDO0lBRUQsNkRBQWtCLEdBQWxCLFVBQW1CLFlBQVk7UUFDN0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxN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SUFBSSxPQUFBLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksRUFBekQsQ0FBeUQsQ0FBQzthQUN0RSxNQUFNLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFOLENBQU0sQ0FBQyxDQUMxQixDQUFDO0lBQ0osQ0FBQzs7Z0JBeEUwQixZQUFZO2dCQUFxQixnQkFBZ0I7O0lBRjVFO1FBREMsU0FBUyxDQUFDLDJCQUEyQixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDOzRFQUNkO0lBYmpDLGdDQUFnQztRQUo1QyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsZ0NBQWdDO1lBQzFDLDRzQkFBd0Q7U0FDekQsQ0FBQztPQUNXLGdDQUFnQyxDQXdGNUM7SUFBRCx1Q0FBQztDQUFBLEFBeEZELENBQXNELG9CQUFvQixHQXdGekU7U0F4RlksZ0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2RrU3RlcCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zdGVwcGVyJztcbmltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJT3BlcmF0aW9uIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgQzh5U3RlcHBlciwgZ2V0dGV4dCwgTW9kYWxTZXJ2aWNlLCBTdGF0dXMgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IHVuaXEgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQmFzZVN0ZXBwZXJDb21wb25lbnQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL29wZXJhdGlvbnMvYnVsay1vcGVyYXRpb24tc3RlcHBlcic7XG5pbXBvcnQgeyBPcGVyYXRpb25EZXRhaWxzIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zL2J1bGstb3BlcmF0aW9ucy1zZXJ2aWNlJztcbmltcG9ydCB7IFNlbGVjdFNvZnR3YXJlU3RlcENvbXBvbmVudCB9IGZyb20gJy4vc2VsZWN0LXNvZnR3YXJlLXN0ZXAuY29tcG9uZW50JztcbmltcG9ydCB7IElTZWxlY3RlZFNvZnR3YXJlLCBJU29mdHdhcmVVcGRhdGVPcGVyYXRpb25Qcm90b3R5cGUgfSBmcm9tICcuL3NlbGVjdC1zb2Z0d2FyZS5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zdGVwcGVyLWJ1bGstdHlwZS1zb2Z0d2FyZScsXG4gIHRlbXBsYXRlVXJsOiAnc3RlcHBlci1idWxrLXR5cGUtc29mdHdhcmUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFN0ZXBwZXJCdWxrVHlwZVNvZnR3YXJlQ29tcG9uZW50IGV4dGVuZHMgQmFzZVN0ZXBwZXJDb21wb25lbnQge1xuICByZWFkb25seSBkZXNjcmlwdGlvblRlbXBsYXRlU2luZ2xlOiBzdHJpbmcgPSBnZXR0ZXh0KFxuICAgICdVcGRhdGUgc29mdHdhcmUgdG86IHt7IG5hbWUgfX0gKHZlcnNpb24ge3sgdmVyc2lvbiB9fSknXG4gICk7XG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uVGVtcGxhdGVPbmVPdGhlcjogc3RyaW5nID0gZ2V0dGV4dChcbiAgICAnVXBkYXRlIHNvZnR3YXJlIHRvOiB7eyBuYW1lIH19ICh2ZXJzaW9uIHt7IHZlcnNpb24gfX0pIGFuZCBvbmUgb3RoZXInXG4gICk7XG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uVGVtcGxhdGVNdWx0aXBsZTogc3RyaW5nID0gZ2V0dGV4dChcbiAgICAnVXBkYXRlIHNvZnR3YXJlIHRvOiB7eyBuYW1lIH19ICh2ZXJzaW9uIHt7IHZlcnNpb24gfX0pIGFuZCB7eyBjb3VudCB9fSBvdGhlcnMnXG4gICk7XG5cbiAgc2VsZWN0ZWRTb2Z0d2FyZTogSVNlbGVjdGVkU29mdHdhcmVbXSA9IFtdO1xuICBAVmlld0NoaWxkKFNlbGVjdFNvZnR3YXJlU3RlcENvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pXG4gIHNlbGVjdFNvZnR3YXJlOiBTZWxlY3RTb2Z0d2FyZVN0ZXBDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtb2RhbDogTW9kYWxTZXJ2aWNlLCBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBvblNvZnR3YXJlU2VsZWN0ZWQoc2VsZWN0ZWRJdGVtKSB7XG4gICAgdGhpcy5zZWxlY3RlZFNvZnR3YXJlID0gdGhpcy5zZWxlY3RlZFNvZnR3YXJlLmZpbHRlcihcbiAgICAgIGl0ZW0gPT4gaXRlbS5zb2Z0d2FyZS5pZCAhPT0gc2VsZWN0ZWRJdGVtLnNvZnR3YXJlLmlkXG4gICAgKTtcbiAgICB0aGlzLnNlbGVjdGVkU29mdHdhcmUucHVzaChzZWxlY3RlZEl0ZW0pO1xuICB9XG5cbiAgYXN5bmMgY29uZmlybVNvZnR3YXJlU2VsZWN0aW9uKCRldmVudDogeyBzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwIH0pIHtcbiAgICBjb25zdCBkZXZpY2VUeXBlczogc3RyaW5nW10gPSB0aGlzLmdldFVuaXF1ZURldmljZVR5cGVzKCk7XG4gICAgdGhpcy5kZXZpY2VUeXBlcyA9IGRldmljZVR5cGVzO1xuICAgIGlmIChkZXZpY2VUeXBlcy5sZW5ndGggPiAxKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLm1vZGFsLmNvbmZpcm0oXG4gICAgICAgICAgZ2V0dGV4dCgnU2VsZWN0ZWQgc29mdHdhcmUgZm9yIHZhcmlvdXMgZGV2aWNlIHR5cGVzJyksXG4gICAgICAgICAgZ2V0dGV4dCgnT3BlcmF0aW9uIG1heSBmYWlsIGR1ZSB0byB1bnN1cHBvcnRlZCBzb2Z0d2FyZS4gRG8geW91IHdhbnQgdG8gcHJvY2VlZD8nKSxcbiAgICAgICAgICBTdGF0dXMuV0FSTklORyxcbiAgICAgICAgICB7IG9rOiBnZXR0ZXh0KCdDb25maXJtJyksIGNhbmNlbDogZ2V0dGV4dCgnQ2FuY2VsJykgfVxuICAgICAgICApO1xuICAgICAgICAkZXZlbnQuc3RlcHBlci5uZXh0KCk7XG4gICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkU29mdHdhcmUgPSBbXTtcbiAgICAgICAgdGhpcy5zZWxlY3RTb2Z0d2FyZS5yZXNldFNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAkZXZlbnQuc3RlcHBlci5uZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHJldHJpZXZlT3BlcmF0aW9uUHJvdG90eXBlKCk6IE9wZXJhdGlvbkRldGFpbHMge1xuICAgIGNvbnN0IHNvZnR3YXJlTGlzdDogSVNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uUHJvdG90eXBlW10gPSB0aGlzLnNlbGVjdGVkU29mdHdhcmUubWFwKGl0ZW0gPT4gKHtcbiAgICAgIG5hbWU6IGl0ZW0uc29mdHdhcmUubmFtZSxcbiAgICAgIHZlcnNpb246IGl0ZW0udmVyc2lvbi5jOHlfU29mdHdhcmUudmVyc2lvbixcbiAgICAgIHVybDogaXRlbS52ZXJzaW9uLmM4eV9Tb2Z0d2FyZS51cmwsXG4gICAgICBhY3Rpb246IGl0ZW0uYWN0aW9uXG4gICAgfSkpO1xuXG4gICAgY29uc3QgaW50ZXJwb2xhdGlvblBhcmFtczogb2JqZWN0ID0ge1xuICAgICAgbmFtZTogc29mdHdhcmVMaXN0WzBdLm5hbWUsXG4gICAgICB2ZXJzaW9uOiBzb2Z0d2FyZUxpc3RbMF0udmVyc2lvbixcbiAgICAgIGNvdW50OiBzb2Z0d2FyZUxpc3QubGVuZ3RoIC0gMVxuICAgIH07XG4gICAgbGV0IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgc3dpdGNoIChzb2Z0d2FyZUxpc3QubGVuZ3RoKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGRlc2NyaXB0aW9uID0gdGhpcy50cmFuc2xhdGUuaW5zdGFudCh0aGlzLmRlc2NyaXB0aW9uVGVtcGxhdGVTaW5nbGUsIGludGVycG9sYXRpb25QYXJhbXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZGVzY3JpcHRpb24gPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KHRoaXMuZGVzY3JpcHRpb25UZW1wbGF0ZU9uZU90aGVyLCBpbnRlcnBvbGF0aW9uUGFyYW1zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBkZXNjcmlwdGlvbiA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQodGhpcy5kZXNjcmlwdGlvblRlbXBsYXRlTXVsdGlwbGUsIGludGVycG9sYXRpb25QYXJhbXMpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBnZXR0ZXh0KCdTb2Z0d2FyZSB1cGRhdGUnKSxcbiAgICAgIHByb3RvdHlwZTogKHtcbiAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgIGM4eV9Tb2Z0d2FyZVVwZGF0ZTogc29mdHdhcmVMaXN0XG4gICAgICB9IGFzIHVua25vd24pIGFzIElPcGVyYXRpb25cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRVbmlxdWVEZXZpY2VUeXBlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHVuaXEoXG4gICAgICB0aGlzLnNlbGVjdGVkU29mdHdhcmVcbiAgICAgICAgLm1hcChpdGVtID0+IGl0ZW0uc29mdHdhcmUuYzh5X0ZpbHRlciAmJiBpdGVtLnNvZnR3YXJlLmM4eV9GaWx0ZXIudHlwZSlcbiAgICAgICAgLmZpbHRlcih0eXBlID0+ICEhdHlwZSlcbiAgICApO1xuICB9XG59XG4iXX0=