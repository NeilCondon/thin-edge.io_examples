import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { AlertService } from '@c8y/ngx-components';
import { orderBy, isEqual, remove, some } from 'lodash-es';
import { InventoryService, IdReference } from '@c8y/client';
import { FetchClient, IFetchOptions } from '@c8y/client';
var ReportsService = /** @class */ (function () {
    function ReportsService(alertService, inventoryService, client) {
        this.alertService = alertService;
        this.inventoryService = inventoryService;
        this.client = client;
        this.microserviceUrl = '/service/reporting/schedule';
        this.headers = { 'Content-Type': 'application/json' };
    }
    ReportsService.prototype.getExport = function (exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var exp, exportDetail, data, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.inventoryService.detail(exportId)];
                    case 1:
                        exportDetail = _a.sent();
                        data = exportDetail.data, res = exportDetail.res;
                        if (res.status !== 200) {
                            this.alertService.addServerFailure({ data: data, res: res });
                        }
                        else {
                            exp = data ? data : {};
                        }
                        return [2 /*return*/, exp];
                }
            });
        });
    };
    ReportsService.prototype.getScheduleList = function (exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var exp;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getExport(exportId)];
                    case 1:
                        exp = _a.sent();
                        return [2 /*return*/, this.extractScheduleListFromExport(exp)];
                }
            });
        });
    };
    ReportsService.prototype.extractScheduleListFromExport = function (exp) {
        var scheduleList;
        if (exp) {
            scheduleList = exp.c8y_ScheduleConfiguration ? exp.c8y_ScheduleConfiguration : [];
        }
        return orderBy(scheduleList, ['timestamp'], ['desc']);
    };
    ReportsService.prototype.addSchedule = function (schedule, exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.updateSchedules(exportId, [], [schedule])];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    ReportsService.prototype.updateSchedule = function (oldSchedule, schedule, exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.updateSchedules(exportId, [oldSchedule], [schedule])];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    ReportsService.prototype.updateSchedules = function (exportId, schedulesToRemove, schedulesToAdd) {
        if (schedulesToRemove === void 0) { schedulesToRemove = []; }
        if (schedulesToAdd === void 0) { schedulesToAdd = []; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var success, exp, schedules, _a, data, res;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        success = false;
                        return [4 /*yield*/, this.getExport(exportId)];
                    case 1:
                        exp = _b.sent();
                        schedules = this.extractScheduleListFromExport(exp);
                        remove(schedules, function (schedule) {
                            return some(schedulesToRemove, function (scheduleToRemove) { return isEqual(schedule, scheduleToRemove); });
                        });
                        schedules.push.apply(schedules, schedulesToAdd);
                        exp.c8y_ScheduleConfiguration = schedules;
                        return [4 /*yield*/, this.inventoryService.update(exp)];
                    case 2:
                        _a = _b.sent(), data = _a.data, res = _a.res;
                        if (!(res.status === 200)) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.reschedule(exportId)];
                    case 3:
                        success = _b.sent();
                        return [3 /*break*/, 5];
                    case 4:
                        this.alertService.addServerFailure({ data: data, res: res });
                        _b.label = 5;
                    case 5: return [2 /*return*/, success];
                }
            });
        });
    };
    ReportsService.prototype.reschedule = function (exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var options, rescheduling;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        options = {
                            method: 'PUT',
                            headers: this.headers
                        };
                        return [4 /*yield*/, this.client.fetch(this.microserviceUrl + "/" + exportId, options)];
                    case 1:
                        rescheduling = _a.sent();
                        return [2 /*return*/, rescheduling.status === 200];
                }
            });
        });
    };
    ReportsService.prototype.deleteSchedule = function (schedule, exportId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.updateSchedules(exportId, [schedule], [])];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    ReportsService.ctorParameters = function () { return [
        { type: AlertService },
        { type: InventoryService },
        { type: FetchClient }
    ]; };
    ReportsService = tslib_1.__decorate([
        Injectable()
    ], ReportsService);
    return ReportsService;
}());
export { ReportsService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0cy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvcnRzLyIsInNvdXJjZXMiOlsicmVwb3J0cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzNELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDNUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFJekQ7SUFJRSx3QkFDVSxZQUEwQixFQUMxQixnQkFBa0MsRUFDbEMsTUFBbUI7UUFGbkIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxXQUFNLEdBQU4sTUFBTSxDQUFhO1FBRTNCLElBQUksQ0FBQyxlQUFlLEdBQUcsNkJBQTZCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDO0lBQ3hELENBQUM7SUFFSyxrQ0FBUyxHQUFmLFVBQWdCLFFBQXFCOzs7Ozs0QkFFZCxxQkFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFBOzt3QkFBM0QsWUFBWSxHQUFHLFNBQTRDO3dCQUN6RCxJQUFJLEdBQVUsWUFBWSxLQUF0QixFQUFFLEdBQUcsR0FBSyxZQUFZLElBQWpCLENBQWtCO3dCQUNuQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFOzRCQUN0QixJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFD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bUNBQVUsR0FBaEIsVUFBaUIsUUFBcUI7Ozs7Ozt3QkFDOUIsT0FBTyxHQUFrQjs0QkFDN0IsTUFBTSxFQUFFLEtBQUs7NEJBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO3lCQUN0QixDQUFDO3dCQUNtQixxQkFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBSSxJQUFJLENBQUMsZUFBZSxTQUFJLFFBQVUsRUFBRSxPQUFPLENBQUMsRUFBQTs7d0JBQXRGLFlBQVksR0FBRyxTQUF1RTt3QkFDNUYsc0JBQU8sWUFBWSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUM7Ozs7S0FDcEM7SUFFSyx1Q0FBYyxHQUFwQixVQUFxQixRQUFrQixFQUFFLFFBQXFCOzs7OzRCQUNyRCxxQkFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFBOzRCQUEzRCxzQkFBTyxTQUFvRCxFQUFDOzs7O0tBQzdEOztnQkE5RXVCLFlBQVk7Z0JBQ1IsZ0JBQWdCO2dCQUMxQixXQUFXOztJQVBsQixjQUFjO1FBRDFCLFVBQVUsRUFBRTtPQUNBLGNBQWMsQ0FvRjFCO0lBQUQscUJBQUM7Q0FBQSxBQXBGRCxJQW9GQztTQXBGWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRXhwb3J0LCBTY2hlZHVsZSB9IGZyb20gJy4vZXhwb3J0LXNjaGVkdWxlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBvcmRlckJ5LCBpc0VxdWFsLCByZW1vdmUsIHNvbWUgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgSW52ZW50b3J5U2VydmljZSwgSWRSZWZlcmVuY2UgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBGZXRjaENsaWVudCwgSUZldGNoT3B0aW9ucyB9IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlcG9ydHNTZXJ2aWNlIHtcbiAgbWljcm9zZXJ2aWNlVXJsOiBzdHJpbmc7XG4gIGhlYWRlcnM6IGFueTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgaW52ZW50b3J5U2VydmljZTogSW52ZW50b3J5U2VydmljZSxcbiAgICBwcml2YXRlIGNsaWVudDogRmV0Y2hDbGllbnRcbiAgKSB7XG4gICAgdGhpcy5taWNyb3NlcnZpY2VVcmwgPSAnL3NlcnZpY2UvcmVwb3J0aW5nL3NjaGVkdWxlJztcbiAgICB0aGlzLmhlYWRlcnMgPSB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfTtcbiAgfVxuXG4gIGFzeW5jIGdldEV4cG9ydChleHBvcnRJZDogSWRSZWZlcmVuY2UpIHtcbiAgICBsZXQgZXhwOiBFeHBvcnQ7XG4gICAgY29uc3QgZXhwb3J0RGV0YWlsID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlTZXJ2aWNlLmRldGFpbChleHBvcnRJZCk7XG4gICAgY29uc3QgeyBkYXRhLCByZXMgfSA9IGV4cG9ydERldGFpbDtcbiAgICBpZiAocmVzLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKHsgZGF0YSwgcmVzIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBleHAgPSBkYXRhID8gKChkYXRhIGFzIHVua25vd24pIGFzIEV4cG9ydCkgOiAoe30gYXMgRXhwb3J0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXhwO1xuICB9XG5cbiAgYXN5bmMgZ2V0U2NoZWR1bGVMaXN0KGV4cG9ydElkOiBJZFJlZmVyZW5jZSkge1xuICAgIGNvbnN0IGV4cCA9IGF3YWl0IHRoaXMuZ2V0RXhwb3J0KGV4cG9ydElkKTtcblxuICAgIHJldHVybiB0aGlzLmV4dHJhY3RTY2hlZHVsZUxpc3RGcm9tRXhwb3J0KGV4cCk7XG4gIH1cblxuICBleHRyYWN0U2NoZWR1bGVMaXN0RnJvbUV4cG9ydChleHA6IEV4cG9ydCkge1xuICAgIGxldCBzY2hlZHVsZUxpc3Q6IFNjaGVkdWxlW107XG4gICAgaWYgKGV4cCkge1xuICAgICAgc2NoZWR1bGVMaXN0ID0gZXhwLmM4eV9TY2hlZHVsZUNvbmZpZ3VyYXRpb24gPyBleHAuYzh5X1NjaGVkdWxlQ29uZmlndXJhdGlvbiA6IFtdO1xuICAgIH1cbiAgICByZXR1cm4gb3JkZXJCeShzY2hlZHVsZUxpc3QsIFsndGltZXN0YW1wJ10sIFsnZGVzYyddKTtcbiAgfVxuXG4gIGFzeW5jIGFkZFNjaGVkdWxlKHNjaGVkdWxlOiBTY2hlZHVsZSwgZXhwb3J0SWQ6IElkUmVmZXJlbmNlKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXBkYXRlU2NoZWR1bGVzKGV4cG9ydElkLCBbXSwgW3NjaGVkdWxlXSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTY2hlZHVsZShvbGRTY2hlZHVsZTogU2NoZWR1bGUsIHNjaGVkdWxlOiBTY2hlZHVsZSwgZXhwb3J0SWQ6IElkUmVmZXJlbmNlKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXBkYXRlU2NoZWR1bGVzKGV4cG9ydElkLCBbb2xkU2NoZWR1bGVdLCBbc2NoZWR1bGVdKTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVNjaGVkdWxlcyhcbiAgICBleHBvcnRJZDogSWRSZWZlcmVuY2UsXG4gICAgc2NoZWR1bGVzVG9SZW1vdmU6IFNjaGVkdWxlW10gPSBbXSxcbiAgICBzY2hlZHVsZXNUb0FkZDogU2NoZWR1bGVbXSA9IFtdXG4gICkge1xuICAgIGxldCBzdWNjZXNzOiBib29sZWFuID0gZmFsc2U7XG4gICAgY29uc3QgZXhwID0gYXdhaXQgdGhpcy5nZXRFeHBvcnQoZXhwb3J0SWQpO1xuICAgIGNvbnN0IHNjaGVkdWxlcyA9IHRoaXMuZXh0cmFjdFNjaGVkdWxlTGlzdEZyb21FeHBvcnQoZXhwKTtcblxuICAgIHJlbW92ZShzY2hlZHVsZXMsIChzY2hlZHVsZTogU2NoZWR1bGUpID0+XG4gICAgICBzb21lKHNjaGVkdWxlc1RvUmVtb3ZlLCAoc2NoZWR1bGVUb1JlbW92ZTogU2NoZWR1bGUpID0+IGlzRXF1YWwoc2NoZWR1bGUsIHNjaGVkdWxlVG9SZW1vdmUpKVxuICAgICk7XG4gICAgc2NoZWR1bGVzLnB1c2guYXBwbHkoc2NoZWR1bGVzLCBzY2hlZHVsZXNUb0FkZCk7XG4gICAgZXhwLmM4eV9TY2hlZHVsZUNvbmZpZ3VyYXRpb24gPSBzY2hlZHVsZXM7XG4gICAgY29uc3QgeyBkYXRhLCByZXMgfSA9IGF3YWl0IHRoaXMuaW52ZW50b3J5U2VydmljZS51cGRhdGUoZXhwKTtcbiAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5yZXNjaGVkdWxlKGV4cG9ydElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2UuYWRkU2VydmVyRmFpbHVyZSh7IGRhdGEsIHJlcyB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VjY2VzcztcbiAgfVxuXG4gIGFzeW5jIHJlc2NoZWR1bGUoZXhwb3J0SWQ6IElkUmVmZXJlbmNlKSB7XG4gICAgY29uc3Qgb3B0aW9uczogSUZldGNoT3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcbiAgICB9O1xuICAgIGNvbnN0IHJlc2NoZWR1bGluZyA9IGF3YWl0IHRoaXMuY2xpZW50LmZldGNoKGAke3RoaXMubWljcm9zZXJ2aWNlVXJsfS8ke2V4cG9ydElkfWAsIG9wdGlvbnMpO1xuICAgIHJldHVybiByZXNjaGVkdWxpbmcuc3RhdHVzID09PSAyMDA7XG4gIH1cblxuICBhc3luYyBkZWxldGVTY2hlZHVsZShzY2hlZHVsZTogU2NoZWR1bGUsIGV4cG9ydElkOiBJZFJlZmVyZW5jZSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVNjaGVkdWxlcyhleHBvcnRJZCwgW3NjaGVkdWxlXSwgW10pO1xuICB9XG59XG4iXX0=